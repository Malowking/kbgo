<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG API 调试工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .config-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .config-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .config-row label {
            font-weight: 600;
        }

        .config-row input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: normal;
            cursor: pointer;
        }

        .main-content {
            display: flex;
            gap: 20px;
        }

        .sidebar {
            flex: 0 0 250px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            height: fit-content;
        }

        .menu-section {
            margin-bottom: 25px;
        }

        .menu-section-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #495057;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .menu-item {
            padding: 10px 12px;
            margin: 5px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .menu-item:hover {
            background-color: #f8f9fa;
        }

        .menu-item.active {
            background-color: #667eea;
            color: white;
        }

        .api-section {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 25px;
            display: none;
        }

        .api-section.active {
            display: block;
        }

        .api-title {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f2f5;
        }

        .api-method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }

        .method-post {
            background-color: #28a745;
        }

        .method-get {
            background-color: #17a2b8;
        }

        .method-put {
            background-color: #ffc107;
            color: #212529;
        }

        .method-delete {
            background-color: #dc3545;
        }

        .api-description {
            color: #6c757d;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .inline-group {
            display: flex;
            gap: 15px;
        }

        .inline-group .form-group {
            flex: 1;
        }

        .helper-text {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            margin-right: 10px;
        }

        .btn-primary {
            background-color: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background-color: #5a6fd8;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .loading {
            display: none;
            color: #667eea;
            font-weight: 500;
            margin: 15px 0;
        }

        .response-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .response-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #495057;
        }

        .response-status {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: 500;
        }

        .response-status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .response-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .response-body {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 300px;
            overflow-y: auto;
        }

        .required {
            color: #dc3545;
            margin-left: 2px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                flex: 0 0 auto;
            }
            
            .inline-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>RAG API 调试工具</h1>
            <p>快速调试和测试所有知识库相关API接口</p>
        </div>

        <div class="config-section">
            <h3>基础配置</h3>
            <div class="config-row" style="margin-bottom: 10px;">
                <label>环境选择:</label>
                <select class="form-select" id="envSelector" style="flex: 0 0 150px; margin-right: 10px;" onchange="switchEnvironment()">
                    <option value="local">本地环境</option>
                    <option value="remote">远程环境</option>
                    <option value="custom">自定义</option>
                </select>
                <label style="margin-left: 10px;">IP:</label>
                <input type="text" id="serverIp" value="localhost" placeholder="localhost" style="flex: 0 0 200px; margin-right: 10px;">
                <label>端口:</label>
                <input type="number" id="serverPort" value="8000" placeholder="8000" style="flex: 0 0 100px;">
            </div>
            <div class="config-row">
                <label>完整API地址:</label>
                <input type="text" id="baseUrl" value="http://localhost:8000" placeholder="http://localhost:8000" readonly style="background-color: #f0f0f0;">
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <!-- 知识库管理 -->
                <div class="menu-section">
                    <div class="menu-section-title">知识库管理</div>
                    <div class="menu-item active" data-section="kb-create">创建知识库</div>
                    <div class="menu-item" data-section="kb-list">知识库列表</div>
                    <div class="menu-item" data-section="kb-get">获取知识库详情</div>
                    <div class="menu-item" data-section="kb-update">更新知识库</div>
                    <div class="menu-item" data-section="kb-update-status">修改知识库状态</div>
                    <div class="menu-item" data-section="kb-delete">删除知识库</div>
                </div>

                <!-- 文档管理 -->
                <div class="menu-section">
                    <div class="menu-section-title">文档管理</div>
                    <div class="menu-item" data-section="doc-list">文档列表</div>
                    <div class="menu-item" data-section="doc-delete">删除文档</div>
                </div>

                <!-- Chunk管理 -->
                <div class="menu-section">
                    <div class="menu-section-title">Chunk管理</div>
                    <div class="menu-item" data-section="chunk-list">Chunk列表</div>
                    <div class="menu-item" data-section="chunk-delete">删除Chunk</div>
                    <div class="menu-item" data-section="chunk-update-content">更新Chunk状态</div>
                </div>

                <!-- 文档索引 -->
                <div class="menu-section">
                    <div class="menu-section-title">文档索引</div>
                    <div class="menu-item" data-section="indexer-upload">文档上传</div>
                    <div class="menu-item" data-section="indexer-index">文档索引</div>
                </div>

                <!-- 检索接口 -->
                <div class="menu-section">
                    <div class="menu-section-title">检索接口</div>
                    <div class="menu-item" data-section="retriever-standard">标准检索</div>
                </div>

                <!-- 对话接口 -->
                <div class="menu-section">
                    <div class="menu-section-title">对话接口</div>
                    <div class="menu-item" data-section="chat">普通对话</div>
                </div>

                <!-- MCP管理 -->
                <div class="menu-section">
                    <div class="menu-section-title">MCP管理</div>
                    <div class="menu-item" data-section="mcp-registry-create">注册MCP服务</div>
                    <div class="menu-item" data-section="mcp-registry-list">MCP服务列表</div>
                    <div class="menu-item" data-section="mcp-registry-get">获取MCP服务</div>
                    <div class="menu-item" data-section="mcp-registry-update">更新MCP服务</div>
                    <div class="menu-item" data-section="mcp-registry-delete">删除MCP服务</div>
                    <div class="menu-item" data-section="mcp-registry-test">测试MCP连接</div>
                    <div class="menu-item" data-section="mcp-list-tools">列出MCP工具</div>
                    <div class="menu-item" data-section="mcp-call-tool">调用MCP工具</div>
                    <div class="menu-item" data-section="mcp-logs">MCP调用日志</div>
                    <div class="menu-item" data-section="mcp-stats">MCP统计信息</div>
                </div>
                <!-- 模型管理 -->
                <div class="menu-section">
                    <div class="menu-section-title">模型管理</div>
                    <div class="menu-item" data-section="model-register">注册模型</div>
                    <div class="menu-item" data-section="model-update">更新模型</div>
                    <div class="menu-item" data-section="model-delete">删除模型</div>
                    <div class="menu-item" data-section="model-reload">重新加载模型</div>
                    <div class="menu-item" data-section="model-list">模型列表</div>
                    <div class="menu-item" data-section="model-get">获取模型详情</div>
                    <div class="menu-item" data-section="model-chat">模型对话调用</div>
                    <div class="menu-item" data-section="model-embeddings">向量化接口</div>
                </div>

            </div>

            <!-- 创建知识库 -->
            <div class="api-section active" id="kb-create">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    创建知识库
                </h2>
                <p class="api-description">创建一个新的知识库，系统会自动在Milvus中创建对应的集合</p>

                <div class="form-group">
                    <label class="form-label">知识库名称 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="kb_create_name" placeholder="例如: 技术文档库">
                    <div class="helper-text">长度3-50字符</div>
                </div>

                <div class="form-group">
                    <label class="form-label">描述 <span class="required">*</span></label>
                    <textarea class="form-textarea" id="kb_create_desc" placeholder="例如: 存储所有技术相关文档"></textarea>
                    <div class="helper-text">长度3-200字符</div>
                </div>

                <div class="form-group">
                    <label class="form-label">分类</label>
                    <input type="text" class="form-input" id="kb_create_category" placeholder="例如: 技术">
                    <div class="helper-text">可选，长度3-50字符</div>
                </div>

                <button class="btn btn-primary" onclick="createKB()">创建知识库</button>
                <button class="btn btn-secondary" onclick="clearForm('kb-create')">清空</button>

                <div class="loading" id="kb_create_loading">请求中...</div>

                <div class="response-section" id="kb_create_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="kb_create_status"></div>
                    <div class="response-body" id="kb_create_body"></div>
                </div>
            </div>

            <!-- 知识库列表 -->
            <div class="api-section" id="kb-list">
                <h2 class="api-title">
                    <span class="api-method method-get">GET</span>
                    知识库列表
                </h2>
                <p class="api-description">获取知识库列表，支持按名称、状态、分类过滤</p>

                <div class="form-group">
                    <label class="form-label">知识库名称</label>
                    <input type="text" class="form-input" id="kb_list_name" placeholder="可选，模糊匹配">
                </div>

                <div class="form-group">
                    <label class="form-label">状态</label>
                    <select class="form-select" id="kb_filter_status">
                        <option value="">全部</option>
                        <option value="1">启用</option>
                        <option value="2">禁用</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">分类</label>
                    <input type="text" class="form-input" id="kb_list_category" placeholder="可选">
                </div>

                <button class="btn btn-primary" onclick="getKBList()">查询</button>
                <button class="btn btn-secondary" onclick="clearForm('kb-list')">清空</button>

                <div class="loading" id="kb_list_loading">请求中...</div>

                <div class="response-section" id="kb_list_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="kb_list_status"></div>
                    <div class="response-body" id="kb_list_body"></div>
                </div>
            </div>

            <!-- 获取知识库详情 -->
            <div class="api-section" id="kb-get">
                <h2 class="api-title">
                    <span class="api-method method-get">GET</span>
                    获取知识库详情
                </h2>
                <p class="api-description">根据ID获取知识库详细信息</p>

                <div class="form-group">
                    <label class="form-label">知识库ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="kb_get_id" placeholder="输入知识库ID">
                </div>

                <button class="btn btn-primary" onclick="getKB()">查询</button>
                <button class="btn btn-secondary" onclick="clearForm('kb-get')">清空</button>

                <div class="loading" id="kb_get_loading">请求中...</div>

                <div class="response-section" id="kb_get_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="kb_get_status"></div>
                    <div class="response-body" id="kb_get_body"></div>
                </div>
            </div>

            <!-- 更新知识库 -->
            <div class="api-section" id="kb-update">
                <h2 class="api-title">
                    <span class="api-method method-put">PUT</span>
                    更新知识库
                </h2>
                <p class="api-description">更新知识库信息，所有字段都是可选的</p>

                <div class="form-group">
                    <label class="form-label">知识库ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="kb_update_id" placeholder="输入知识库ID">
                </div>

                <div class="form-group">
                    <label class="form-label">知识库名称</label>
                    <input type="text" class="form-input" id="kb_update_name" placeholder="新的名称">
                </div>

                <div class="form-group">
                    <label class="form-label">描述</label>
                    <textarea class="form-textarea" id="kb_update_desc" placeholder="新的描述"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">分类</label>
                    <input type="text" class="form-input" id="kb_update_category" placeholder="新的分类">
                </div>

                <div class="form-group">
                    <label class="form-label">状态</label>
                    <select class="form-select" id="kb_update_status">
                        <option value="">不修改</option>
                        <option value="1">启用</option>
                        <option value="2">禁用</option>
                    </select>
                </div>

                <button class="btn btn-primary" onclick="updateKB()">更新</button>
                <button class="btn btn-secondary" onclick="clearForm('kb-update')">清空</button>

                <div class="loading" id="kb_update_loading">请求中...</div>

                <div class="response-section" id="kb_update_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="kb_update_status_text"></div>
                    <div class="response-body" id="kb_update_body"></div>
                </div>
            </div>

            <!-- 修改知识库状态 -->
            <div class="api-section" id="kb-update-status">
                <h2 class="api-title">
                    <span class="api-method method-put" style="background: #17a2b8; color: white;">PATCH</span>
                    修改知识库状态
                </h2>
                <p class="api-description">专门用于修改知识库的启用/禁用状态</p>

                <div class="form-group">
                    <label class="form-label">知识库ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="kb_update_status_id" placeholder="输入知识库ID">
                </div>

                <div class="form-group">
                    <label class="form-label">状态 <span class="required">*</span></label>
                    <select class="form-select" id="kb_update_status_value">
                        <option value="">请选择</option>
                        <option value="1">启用</option>
                        <option value="2">禁用</option>
                    </select>
                </div>

                <button class="btn btn-primary" onclick="updateKBStatus()">修改状态</button>
                <button class="btn btn-secondary" onclick="clearForm('kb-update-status')">清空</button>

                <div class="loading" id="kb_update_status_loading">请求中...</div>

                <div class="response-section" id="kb_update_status_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="kb_update_status_status"></div>
                    <div class="response-body" id="kb_update_status_body"></div>
                </div>
            </div>

            <!-- 删除知识库 -->
            <div class="api-section" id="kb-delete">
                <h2 class="api-title">
                    <span class="api-method method-delete">DELETE</span>
                    删除知识库
                </h2>
                <p class="api-description">删除知识库及其在Milvus中的集合，此操作不可恢复</p>

                <div class="form-group">
                    <label class="form-label">知识库ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="kb_delete_id" placeholder="输入知识库ID">
                </div>

                <button class="btn btn-primary" onclick="deleteKB()">删除</button>
                <button class="btn btn-secondary" onclick="clearForm('kb-delete')">清空</button>

                <div class="loading" id="kb_delete_loading">请求中...</div>

                <div class="response-section" id="kb_delete_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="kb_delete_status"></div>
                    <div class="response-body" id="kb_delete_body"></div>
                </div>
            </div>

            <!-- 文档列表 -->
            <div class="api-section" id="doc-list">
                <h2 class="api-title">
                    <span class="api-method method-get">GET</span>
                    文档列表
                </h2>
                <p class="api-description">获取指定知识库下的文档列表，支持分页</p>

                <div class="form-group">
                    <label class="form-label">知识库ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="doc_list_kb_id" placeholder="输入知识库ID">
                </div>

                <div class="inline-group">
                    <div class="form-group">
                        <label class="form-label">页码</label>
                        <input type="number" class="form-input" id="doc_list_page" value="1" min="1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">每页数量</label>
                        <input type="number" class="form-input" id="doc_list_size" value="10" min="1" max="100">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="getDocList()">查询</button>
                <button class="btn btn-secondary" onclick="clearForm('doc-list')">清空</button>

                <div class="loading" id="doc_list_loading">请求中...</div>

                <div class="response-section" id="doc_list_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="doc_list_status"></div>
                    <div class="response-body" id="doc_list_body"></div>
                </div>
            </div>



            <!-- 删除文档 -->
            <div class="api-section" id="doc-delete">
                <h2 class="api-title">
                    <span class="api-method method-delete">DELETE</span>
                    删除文档
                </h2>
                <p class="api-description">删除文档及其所有chunks，同时删除Milvus中的向量数据</p>

                <div class="form-group">
                    <label class="form-label">文档ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="doc_delete_id" placeholder="输入文档ID">
                </div>

                <button class="btn btn-primary" onclick="deleteDoc()">删除</button>
                <button class="btn btn-secondary" onclick="clearForm('doc-delete')">清空</button>

                <div class="loading" id="doc_delete_loading">请求中...</div>

                <div class="response-section" id="doc_delete_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="doc_delete_status"></div>
                    <div class="response-body" id="doc_delete_body"></div>
                </div>
            </div>

            <!-- Chunk列表 -->
            <div class="api-section" id="chunk-list">
                <h2 class="api-title">
                    <span class="api-method method-get">GET</span>
                    Chunk列表
                </h2>
                <p class="api-description">获取指定文档下的chunk列表，支持分页</p>

                <div class="form-group">
                    <label class="form-label">文档ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="chunk_list_doc_id" placeholder="输入文档ID">
                </div>

                <div class="inline-group">
                    <div class="form-group">
                        <label class="form-label">页码</label>
                        <input type="number" class="form-input" id="chunk_list_page" value="1" min="1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">每页数量</label>
                        <input type="number" class="form-input" id="chunk_list_size" value="10" min="1" max="100">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="getChunkList()">查询</button>
                <button class="btn btn-secondary" onclick="clearForm('chunk-list')">清空</button>

                <div class="loading" id="chunk_list_loading">请求中...</div>

                <div class="response-section" id="chunk_list_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="chunk_list_status"></div>
                    <div class="response-body" id="chunk_list_body"></div>
                </div>
            </div>

            <!-- 删除Chunk -->
            <div class="api-section" id="chunk-delete">
                <h2 class="api-title">
                    <span class="api-method method-delete">DELETE</span>
                    删除Chunk
                </h2>
                <p class="api-description">删除指定chunk，同时删除Milvus中的向量数据</p>

                <div class="form-group">
                    <label class="form-label">Chunk ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="chunk_delete_id" placeholder="输入Chunk ID">
                </div>

                <button class="btn btn-primary" onclick="deleteChunk()">删除</button>
                <button class="btn btn-secondary" onclick="clearForm('chunk-delete')">清空</button>

                <div class="loading" id="chunk_delete_loading">请求中...</div>

                <div class="response-section" id="chunk_delete_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="chunk_delete_status"></div>
                    <div class="response-body" id="chunk_delete_body"></div>
                </div>
            </div>

            <!-- 更新Chunk状态 -->
            <div class="api-section" id="chunk-update-content">
                <h2 class="api-title">
                    <span class="api-method method-put">PUT</span>
                    更新Chunk状态
                </h2>
                <p class="api-description">更新指定chunk的状态</p>

                <div class="form-group">
                    <label class="form-label">Chunk ID列表 <span class="required">*</span></label>
                    <textarea class="form-textarea" id="chunk_content_ids" placeholder="多个Chunk ID用逗号分隔，例如: id1,id2,id3"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">状态 <span class="required">*</span></label>
                    <select class="form-select" id="chunk_update_status">
                        <option value="1">启用 (Active)</option>
                        <option value="0">禁用 (Inactive)</option>
                    </select>
                </div>

                <button class="btn btn-primary" onclick="updateChunkStatus()">更新</button>
                <button class="btn btn-secondary" onclick="clearForm('chunk-update-content')">清空</button>

                <div class="loading" id="chunk_content_loading">请求中...</div>

                <div class="response-section" id="chunk_content_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="chunk_content_status"></div>
                    <div class="response-body" id="chunk_content_body"></div>
                </div>
            </div>

            <!-- 文档上传 -->
            <div class="api-section" id="indexer-upload">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    文档上传
                </h2>
                <p class="api-description">上传本地文件或通过URL下载文件并保存到知识库</p>

                <div class="form-group">
                    <label class="form-label">知识库ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="upload_kb_id" placeholder="输入知识库ID">
                </div>

                <div class="form-group">
                    <label class="form-label">上传文件</label>
                    <input type="file" class="form-input" id="upload_file">
                    <div class="helper-text">选择本地文件进行上传</div>
                </div>

                <div class="form-group">
                    <label class="form-label">或输入文件URL</label>
                    <input type="text" class="form-input" id="upload_url" placeholder="例如: https://example.com/doc.pdf">
                    <div class="helper-text">输入文件的网络地址</div>
                </div>

                <button class="btn btn-primary" onclick="uploadFile()">上传文件</button>
                <button class="btn btn-secondary" onclick="clearForm('indexer-upload')">清空</button>

                <div class="loading" id="upload_loading">请求中...</div>

                <div class="response-section" id="upload_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="upload_status"></div>
                    <div class="response-body" id="upload_body"></div>
                </div>
            </div>

            <!-- 文档索引 -->
            <div class="api-section" id="indexer-index">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    文档索引
                </h2>
                <p class="api-description">对已上传的文档进行切分和向量化处理</p>

                <div class="form-group">
                    <label class="form-label">文档ID列表 <span class="required">*</span></label>
                    <textarea class="form-textarea" id="index_doc_ids" placeholder="多个文档ID用逗号分隔，例如: id1,id2,id3"></textarea>
                    <div class="helper-text">输入要索引的文档ID列表</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Embedding模型ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="index_embedding_model_id" placeholder="输入Embedding模型UUID">
                    <div class="helper-text">必填，用于向量化的Embedding模型ID</div>
                </div>

                <div class="inline-group">
                    <div class="form-group">
                        <label class="form-label">Chunk Size</label>
                        <input type="number" class="form-input" id="index_chunk_size" value="1000" min="1">
                        <div class="helper-text">文档分块大小，默认1000</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Overlap Size</label>
                        <input type="number" class="form-input" id="index_overlap_size" value="100" min="0">
                        <div class="helper-text">分块重叠大小，默认100</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">自定义分隔符</label>
                    <input type="text" class="form-input" id="index_separators" placeholder="例如: \n\n,\n">
                    <div class="helper-text">可选，多个分隔符用逗号分隔。例如: \n\n,\n 表示优先按双换行符分割，其次按单换行符分割</div>
                </div>

                <button class="btn btn-primary" onclick="indexDocuments()">索引文档</button>
                <button class="btn btn-secondary" onclick="clearForm('indexer-index')">清空</button>

                <div class="loading" id="index_loading">请求中...</div>

                <div class="response-section" id="index_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="index_status"></div>
                    <div class="response-body" id="index_body"></div>
                </div>
            </div>

            <!-- 标准检索 -->
            <div class="api-section" id="retriever-standard">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    标准检索
                </h2>
                <p class="api-description">标准检索接口，支持多种检索模式和查询重写</p>

                <div class="form-group">
                    <label class="form-label">知识库ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="retriever_kb_id" placeholder="请输入知识库ID">
                    <div class="helper-text">必填，要检索的知识库ID</div>
                </div>

                <div class="form-group">
                    <label class="form-label">检索问题 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="retriever_question" placeholder="请输入要检索的问题">
                    <div class="helper-text">必填，要检索的问题内容</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Embedding模型ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="retriever_embedding_model_id" placeholder="输入Embedding模型UUID">
                    <div class="helper-text">必填，用于向量化的Embedding模型ID</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Rerank模型ID</label>
                    <input type="text" class="form-input" id="retriever_rerank_model_id" placeholder="输入Rerank模型UUID（可选）">
                    <div class="helper-text">可选，仅在检索模式为rerank或rrf时需要</div>
                </div>

                <div class="inline-group">
                    <div class="form-group">
                        <label class="form-label">返回数量</label>
                        <input type="number" class="form-input" id="retriever_top_k" value="5" min="1" max="100">
                        <div class="helper-text">默认5，返回最相关的前N个结果</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">相似度阈值</label>
                        <input type="number" class="form-input" id="retriever_score" value="0.2" min="0" max="1" step="0.01">
                        <div class="helper-text">0-1范围(归一化后)，0=完全不相关，1=完全相同，推荐0.2-0.5</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">启用查询重写</label>
                    <select class="form-select" id="retriever_enable_rewrite">
                        <option value="false">否 (默认)</option>
                        <option value="true">是</option>
                        </select>
                    <div class="helper-text">启用后将使用LLM对查询进行重写优化，可提高召回率但速度较慢</div>
                </div>

                <div class="form-group">
                    <label class="form-label">重写尝试次数</label>
                    <input type="number" class="form-input" id="retriever_rewrite_attempts" value="3" min="1" max="10">
                    <div class="helper-text">仅在启用查询重写时生效，默认3次</div>
                </div>

                <div class="form-group">
                    <label class="form-label">检索模式</label>
                    <select class="form-select" id="retriever_retrieve_mode">
                        <option value="rerank">Rerank (默认)</option>
                        <option value="milvus">Milvus Only</option>
                        <option value="rrf">RRF混合</option>
                    </select>
                    <div class="helper-text">
                        <strong>Rerank</strong>: Milvus检索+重排序(推荐)
                        <strong>Milvus Only</strong>: 仅向量检索
                        <strong>RRF</strong>: Reciprocal Rank Fusion混合检索
                    </div>
                </div>

                <button class="btn btn-primary" onclick="retrieve()">
                    <i class="icon-send"></i>执行检索
                </button>

                <div class="loading" id="retriever_loading">请求中...</div>

                <div class="response-section" id="retriever_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="retriever_status"></div>
                    <div class="response-body" id="retriever_body"></div>
                </div>
            </div>

            <!-- 普通对话 -->
            <div class="api-section" id="chat">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    普通对话
                </h2>
                <p class="api-description">基于知识库的问答对话（RAG）</p>

                <div class="form-group">
                    <label class="form-label">会话ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="chat_conv_id" placeholder="输入会话ID，例如: session_123">
                </div>

                <div class="form-group">
                    <label class="form-label">问题 <span class="required">*</span></label>
                    <textarea class="form-textarea" id="chat_question" placeholder="输入您的问题"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">文件上传</label>
                    <input type="file" class="form-input" id="chat_file" multiple>
                    <div class="helper-text">可选，支持多个文件上传（用于多模态模型）</div>
                </div>

                <div class="form-group">
                    <label class="form-label">LLM模型ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="chat_model_id" placeholder="输入LLM模型UUID">
                    <div class="helper-text">必填，用于对话的LLM模型ID</div>
                </div>

                <div class="form-group">
                    <label class="form-label">知识库ID</label>
                    <input type="text" class="form-input" id="chat_kb_id" placeholder="输入知识库ID（可选）">
                </div>

                <div class="form-group">
                    <label class="form-label">启用知识库检索</label>
                    <div>
                        <label>
                            <input type="checkbox" id="chat_enable_retriever" checked>
                            启用知识库检索
                        </label>
                    </div>
                    <div class="helper-text">即使提供了知识库ID，也需要启用此选项才会进行检索</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Embedding模型ID</label>
                    <input type="text" class="form-input" id="chat_embedding_model_id" placeholder="输入Embedding模型UUID（启用检索时需要）">
                    <div class="helper-text">启用检索时必填，用于向量化</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Rerank模型ID</label>
                    <input type="text" class="form-input" id="chat_rerank_model_id" placeholder="输入Rerank模型UUID（可选）">
                    <div class="helper-text">可选，仅在使用rerank或rrf检索模式时需要</div>
                </div>

                <div class="inline-group">
                    <div class="form-group">
                        <label class="form-label">TopK</label>
                        <input type="number" class="form-input" id="chat_top_k" value="5" min="1" max="100">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Score阈值</label>
                        <input type="number" class="form-input" id="chat_score" value="0.2" min="0" max="1" step="0.01">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">检索模式</label>
                    <select class="form-select" id="chat_retrieve_mode">
                        <option value="">使用配置默认值</option>
                        <option value="milvus">Milvus向量检索</option>
                        <option value="rerank">Rerank重排序</option>
                        <option value="rrf">RRF混合检索</option>
                    </select>
                    <div class="helper-text">选择知识检索方式，留空使用配置文件默认值</div>
                </div>

                <div class="form-group">
                    <label class="form-label">启用MCP</label>
                    <div>
                        <label>
                            <input type="checkbox" id="chat_use_mcp">
                            启用MCP工具调用
                        </label>
                    </div>
                    <div class="helper-text">调用已注册的MCP服务工具</div>
                </div>

                <div class="form-group">
                    <label class="form-label">按服务指定MCP工具</label>
                    <textarea class="form-textarea" id="chat_mcp_service_tools" placeholder='{"service_name": ["tool1", "tool2"]}'></textarea>
                    <div class="helper-text">JSON格式，可按服务指定工具，留空表示调用所有工具</div>
                </div>

                <div class="form-group">
                    <label class="form-label">流式输出</label>
                    <div>
                        <label>
                            <input type="checkbox" id="chat_stream">
                            启用流式输出
                        </label>
                    </div>
                    <div class="helper-text">启用后将以流式方式返回对话内容</div>
                </div>

                <button class="btn btn-primary" onclick="chat()">发送消息</button>
                <button class="btn btn-secondary" onclick="clearForm('chat')">清空</button>

                <div class="loading" id="chat_loading">请求中...</div>

                <div class="response-section" id="chat_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="chat_status"></div>
                    <div class="response-body" id="chat_body"></div>
                </div>
            </div>

            <!-- 注册MCP服务 -->
            <div class="api-section" id="mcp-registry-create">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    注册MCP服务
                </h2>
                <p class="api-description">注册一个外部 MCP 服务到系统中</p>

                <div class="form-group">
                    <label class="form-label">服务名称 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="mcp_reg_name" placeholder="例如: my-search-service">
                    <div class="helper-text">唯一标识，长度1-100字符</div>
                </div>

                <div class="form-group">
                    <label class="form-label">服务描述</label>
                    <textarea class="form-textarea" id="mcp_reg_desc" placeholder="例如: 搜索服务"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">SSE 端点 URL <span class="required">*</span></label>
                    <input type="text" class="form-input" id="mcp_reg_endpoint" placeholder="http://localhost:3000/sse">
                    <div class="helper-text">MCP 服务的 SSE 端点地址</div>
                </div>

                <div class="form-group">
                    <label class="form-label">API Key</label>
                    <input type="text" class="form-input" id="mcp_reg_apikey" placeholder="可选，用于认证">
                </div>

                <div class="form-group">
                    <label class="form-label">自定义请求头 (JSON)</label>
                    <textarea class="form-textarea" id="mcp_reg_headers" placeholder='{"X-Custom-Header": "value"}'></textarea>
                    <div class="helper-text">可选，JSON 格式的自定义请求头</div>
                </div>

                <button class="btn btn-primary" onclick="registerMCP()">注册</button>
                <button class="btn btn-secondary" onclick="clearForm('mcp-registry-create')">清空</button>

                <div class="loading" id="mcp_reg_loading">请求中...</div>

                <div class="response-section" id="mcp_reg_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="mcp_reg_status"></div>
                    <div class="response-body" id="mcp_reg_body"></div>
                </div>
            </div>

            <!-- MCP服务列表 -->
            <div class="api-section" id="mcp-registry-list">
                <h2 class="api-title">
                    <span class="api-method method-get">GET</span>
                    MCP服务列表
                </h2>
                <p class="api-description">获取已注册的MCP服务列表</p>

                <div class="form-group">
                    <label class="form-label">状态</label>
                    <select class="form-select" id="mcp_filter_status">
                        <option value="">全部</option>
                        <option value="1">启用</option>
                        <option value="0">禁用</option>
                    </select>
                </div>

                <div class="inline-group">
                    <div class="form-group">
                        <label class="form-label">页码</label>
                        <input type="number" class="form-input" id="mcp_list_page" value="1" min="1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">每页数量</label>
                        <input type="number" class="form-input" id="mcp_list_size" value="10" min="1" max="100">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="getMCPRegistryList()">查询</button>
                <button class="btn btn-secondary" onclick="clearForm('mcp-registry-list')">清空</button>

                <div class="loading" id="mcp_list_loading">请求中...</div>

                <div class="response-section" id="mcp_list_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="mcp_list_status"></div>
                    <div class="response-body" id="mcp_list_body"></div>
                </div>
            </div>

            <!-- 获取MCP服务 -->
            <div class="api-section" id="mcp-registry-get">
                <h2 class="api-title">
                    <span class="api-method method-get">GET</span>
                    获取MCP服务
                </h2>
                <p class="api-description">根据ID获取MCP服务详情</p>

                <div class="form-group">
                    <label class="form-label">服务ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="mcp_get_id" placeholder="输入MCP服务ID">
                </div>

                <button class="btn btn-primary" onclick="getMCPRegistry()">查询</button>
                <button class="btn btn-secondary" onclick="clearForm('mcp-registry-get')">清空</button>

                <div class="loading" id="mcp_get_loading">请求中...</div>

                <div class="response-section" id="mcp_get_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="mcp_get_status"></div>
                    <div class="response-body" id="mcp_get_body"></div>
                </div>
            </div>

            <!-- 更新MCP服务 -->
            <div class="api-section" id="mcp-registry-update">
                <h2 class="api-title">
                    <span class="api-method method-put">PUT</span>
                    更新 MCP 服务
                </h2>
                <p class="api-description">更新 MCP 服务信息，所有字段都是可选的</p>

                <div class="form-group">
                    <label class="form-label">服务 ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="mcp_update_id" placeholder="输入 MCP 服务 ID">
                </div>

                <div class="form-group">
                    <label class="form-label">服务名称</label>
                    <input type="text" class="form-input" id="mcp_update_name" placeholder="新的服务名称">
                </div>

                <div class="form-group">
                    <label class="form-label">服务描述</label>
                    <textarea class="form-textarea" id="mcp_update_desc" placeholder="新的服务描述"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">SSE 端点 URL</label>
                    <input type="text" class="form-input" id="mcp_update_endpoint" placeholder="新的端点URL">
                </div>

                <div class="form-group">
                    <label class="form-label">API Key</label>
                    <input type="text" class="form-input" id="mcp_update_apikey" placeholder="新的API Key">
                </div>

                <div class="form-group">
                    <label class="form-label">自定义请求头 (JSON)</label>
                    <textarea class="form-textarea" id="mcp_update_headers" placeholder='{"X-Custom-Header": "value"}'></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">状态</label>
                    <select class="form-select" id="mcp_update_status">
                        <option value="">不修改</option>
                        <option value="1">启用</option>
                        <option value="0">禁用</option>
                    </select>
                </div>

                <button class="btn btn-primary" onclick="updateMCPRegistry()">更新</button>
                <button class="btn btn-secondary" onclick="clearForm('mcp-registry-update')">清空</button>

                <div class="loading" id="mcp_update_loading">请求中...</div>

                <div class="response-section" id="mcp_update_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="mcp_update_status_text"></div>
                    <div class="response-body" id="mcp_update_body"></div>
                </div>
            </div>

            <!-- 删除MCP服务 -->
            <div class="api-section" id="mcp-registry-delete">
                <h2 class="api-title">
                    <span class="api-method method-delete">DELETE</span>
                    删除 MCP 服务
                </h2>
                <p class="api-description">删除指定的 MCP 服务</p>

                <div class="form-group">
                    <label class="form-label">服务 ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="mcp_delete_id" placeholder="输入 MCP 服务 ID">
                </div>

                <button class="btn btn-primary" onclick="deleteMCPRegistry()">删除</button>
                <button class="btn btn-secondary" onclick="clearForm('mcp-registry-delete')">清空</button>

                <div class="loading" id="mcp_delete_loading">请求中...</div>

                <div class="response-section" id="mcp_delete_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="mcp_delete_status"></div>
                    <div class="response-body" id="mcp_delete_body"></div>
                </div>
            </div>

            <!-- 测试MCP连接 -->
            <div class="api-section" id="mcp-registry-test">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    测试 MCP 连接
                </h2>
                <p class="api-description">测试指定 MCP 服务的连接状态</p>

                <div class="form-group">
                    <label class="form-label">服务 ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="mcp_test_id" placeholder="输入 MCP 服务 ID">
                </div>

                <button class="btn btn-primary" onclick="testMCPRegistry()">测试</button>
                <button class="btn btn-secondary" onclick="clearForm('mcp-registry-test')">清空</button>

                <div class="loading" id="mcp_test_loading">请求中...</div>

                <div class="response-section" id="mcp_test_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="mcp_test_status"></div>
                    <div class="response-body" id="mcp_test_body"></div>
                </div>
            </div>

            <!-- 列出MCP工具 -->
            <div class="api-section" id="mcp-list-tools">
                <h2 class="api-title">
                    <span class="api-method method-get">GET</span>
                    列出 MCP 工具
                </h2>
                <p class="api-description">列出指定 MCP 服务可用的工具</p>

                <div class="form-group">
                    <label class="form-label">服务 ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="mcp_tools_id" placeholder="输入 MCP 服务 ID">
                </div>

                <button class="btn btn-primary" onclick="listMCPTools()">查询</button>
                <button class="btn btn-secondary" onclick="clearForm('mcp-list-tools')">清空</button>

                <div class="loading" id="mcp_tools_loading">请求中...</div>

                <div class="response-section" id="mcp_tools_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="mcp_tools_status"></div>
                    <div class="response-body" id="mcp_tools_body"></div>
                </div>
            </div>

            <!-- 调用MCP工具 -->
            <div class="api-section" id="mcp-call-tool">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    调用 MCP 工具
                </h2>
                <p class="api-description">调用指定的 MCP 工具</p>

                <div class="form-group">
                    <label class="form-label">服务 ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="mcp_call_registry_id" placeholder="输入 MCP 服务 ID 或服务名称">
                </div>

                <div class="form-group">
                    <label class="form-label">工具名称 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="mcp_call_tool_name" placeholder="输入工具名称">
                </div>

                <div class="form-group">
                    <label class="form-label">参数 (JSON)</label>
                    <textarea class="form-textarea" id="mcp_call_args" placeholder='{"param1": "value1", "param2": "value2"}'></textarea>
                    <div class="helper-text">工具调用参数，JSON格式</div>
                </div>

                <div class="form-group">
                    <label class="form-label">对话ID</label>
                    <input type="text" class="form-input" id="mcp_call_conv_id" placeholder="可选，用于日志记录">
                </div>

                <button class="btn btn-primary" onclick="callMCPTool()">调用</button>
                <button class="btn btn-secondary" onclick="clearForm('mcp-call-tool')">清空</button>

                <div class="loading" id="mcp_call_loading">请求中...</div>

                <div class="response-section" id="mcp_call_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="mcp_call_status"></div>
                    <div class="response-body" id="mcp_call_body"></div>
                </div>
            </div>

            <!-- MCP调用日志 -->
            <div class="api-section" id="mcp-logs">
                <h2 class="api-title">
                    <span class="api-method method-get">GET</span>
                    MCP 调用日志
                </h2>
                <p class="api-description">获取 MCP 工具调用日志</p>

                <div class="form-group">
                    <label class="form-label">对话ID</label>
                    <input type="text" class="form-input" id="mcp_logs_conv_id" placeholder="可选，按对话ID过滤">
                </div>

                <div class="form-group">
                    <label class="form-label">服务ID</label>
                    <input type="text" class="form-input" id="mcp_logs_registry_id" placeholder="可选，按服务ID过滤">
                </div>

                <div class="form-group">
                    <label class="form-label">工具名称</label>
                    <input type="text" class="form-input" id="mcp_logs_tool_name" placeholder="可选，按工具名称过滤">
                </div>

                <div class="inline-group">
                    <div class="form-group">
                        <label class="form-label">页码</label>
                        <input type="number" class="form-input" id="mcp_logs_page" value="1" min="1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">每页数量</label>
                        <input type="number" class="form-input" id="mcp_logs_size" value="10" min="1" max="100">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="getMCPLogs()">查询日志</button>
                <button class="btn btn-secondary" onclick="clearForm('mcp-logs')">清空</button>

                <div class="loading" id="mcp_logs_loading">请求中...</div>

                <div class="response-section" id="mcp_logs_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="mcp_logs_status_text"></div>
                    <div class="response-body" id="mcp_logs_body"></div>
                </div>
            </div>

            <!-- MCP统计信息 -->
            <div class="api-section" id="mcp-stats">
                <h2 class="api-title">
                    <span class="api-method method-get">GET</span>
                    MCP 统计信息
                </h2>
                <p class="api-description">获取指定 MCP 服务的调用统计信息</p>

                <div class="form-group">
                    <label class="form-label">服务 ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="mcp_stats_id" placeholder="输入 MCP 服务 ID">
                </div>

                <button class="btn btn-primary" onclick="getMCPStats()">查询</button>
                <button class="btn btn-secondary" onclick="clearForm('mcp-stats')">清空</button>

                <div class="loading" id="mcp_stats_loading">请求中...</div>

                <div class="response-section" id="mcp_stats_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="mcp_stats_status"></div>
                    <div class="response-body" id="mcp_stats_body"></div>
                </div>
            </div>

            <!-- 模型管理 - 注册模型 -->
            <div id="model-register" class="api-section">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    注册模型
                </h2>
                <p class="api-description">注册新模型到系统（模型ID将自动生成）</p>

                <div class="form-group">
                    <label class="form-label">模型名称 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="model_register_name" placeholder="例如: GPT-4">
                    <div class="helper-text">模型的显示名称</div>
                </div>

                <div class="form-group">
                    <label class="form-label">模型类型 <span class="required">*</span></label>
                    <select class="form-select" id="model_register_type">
                        <option value="">请选择</option>
                        <option value="llm">LLM (大语言模型)</option>
                        <option value="embedding">Embedding (向量化模型)</option>
                        <option value="reranker">Reranker (重排序模型)</option>
                        <option value="multimodal">Multimodal (多模态模型)</option>
                        <option value="image">Image (图像模型)</option>
                        <option value="video">Video (视频模型)</option>
                        <option value="audio">Audio (音频模型)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">提供商</label>
                    <input type="text" class="form-input" id="model_register_provider" placeholder="例如: openai, ollama, anthropic">
                    <div class="helper-text">模型提供商名称（可选）</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Base URL</label>
                    <input type="text" class="form-input" id="model_register_base_url" placeholder="https://api.openai.com/v1">
                    <div class="helper-text">API基础URL（可选，留空使用默认值）</div>
                </div>

                <div class="form-group">
                    <label class="form-label">API Key</label>
                    <input type="password" class="form-input" id="model_register_api_key" placeholder="sk-...">
                    <div class="helper-text">API密钥（可选）</div>
                </div>

                <div class="inline-group">
                    <div class="form-group">
                        <label class="form-label">上下文窗口</label>
                        <input type="number" class="form-input" id="model_register_context_window" placeholder="8192">
                        <div class="helper-text">最大上下文长度</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">最大Token数</label>
                        <input type="number" class="form-input" id="model_register_max_tokens" placeholder="4096">
                        <div class="helper-text">单次生成最大token数</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">向量维度</label>
                    <input type="number" class="form-input" id="model_register_dimension" placeholder="1536">
                    <div class="helper-text">仅用于Embedding模型，向量的维度大小</div>
                </div>

                <div class="form-group">
                    <label class="form-label">模型其他参数 (Config)</label>
                    <textarea class="form-textarea" id="model_register_config" rows="3" placeholder='{"temperature": 0.7, "top_p": 0.9}'></textarea>
                    <div class="helper-text">JSON格式的模型配置参数（可选）</div>
                </div>

                <div class="form-group">
                    <label><input type="checkbox" id="model_register_enabled" checked> 启用模型</label>
                </div>

                <button class="btn btn-primary" onclick="registerModel()">注册模型</button>
                <button class="btn btn-secondary" onclick="clearForm('model-register')">清除</button>

                <div class="loading" id="model_register_loading">请求中...</div>
                <div class="response-section" id="model_register_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="model_register_status"></div>
                    <div class="response-body" id="model_register_body"></div>
                </div>
            </div>

            <!-- 模型管理 - 更新模型 -->
            <div id="model-update" class="api-section">
                <h2 class="api-title">
                    <span class="api-method method-put">PUT</span>
                    更新模型
                </h2>
                <p class="api-description">更新模型配置</p>
                <div class="form-group">
                    <label class="form-label">模型ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="model_update_id">
                </div>
                <div class="form-group">
                    <label class="form-label">模型名称</label>
                    <input type="text" class="form-input" id="model_update_name">
                </div>
                <div class="form-group">
                    <label class="form-label">Base URL</label>
                    <input type="text" class="form-input" id="model_update_base_url">
                </div>
                <button class="btn btn-primary" onclick="updateModel()">更新</button>
                <button class="btn btn-secondary" onclick="clearForm('model-update')">清除</button>
                <div class="loading" id="model_update_loading">请求中...</div>
                <div class="response-section" id="model_update_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="model_update_status"></div>
                    <div class="response-body" id="model_update_body"></div>
                </div>
            </div>

            <!-- 模型管理 - 删除模型 -->
            <div id="model-delete" class="api-section">
                <h2 class="api-title">
                    <span class="api-method method-delete">DELETE</span>
                    删除模型
                </h2>
                <p class="api-description">删除模型</p>
                <div class="form-group">
                    <label class="form-label">模型ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="model_delete_id">
                </div>
                <button class="btn btn-primary" onclick="deleteModel()">删除</button>
                <button class="btn btn-secondary" onclick="clearForm('model-delete')">清除</button>
                <div class="loading" id="model_delete_loading">请求中...</div>
                <div class="response-section" id="model_delete_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="model_delete_status"></div>
                    <div class="response-body" id="model_delete_body"></div>
                </div>
            </div>

            <!-- 模型管理 - 重新加载模型 -->
            <div id="model-reload" class="api-section">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    重新加载模型
                </h2>
                <p class="api-description">重新加载数据库中的所有模型到注册表</p>
                <button class="btn btn-primary" onclick="reloadModels()">重新加载</button>
                <div class="loading" id="model_reload_loading">请求中...</div>
                <div class="response-section" id="model_reload_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="model_reload_status"></div>
                    <div class="response-body" id="model_reload_body"></div>
                </div>
            </div>

            <!-- 模型管理 - 模型列表 -->
            <div id="model-list" class="api-section">
                <h2 class="api-title">
                    <span class="api-method method-get">GET</span>
                    模型列表
                </h2>
                <p class="api-description">获取所有已注册的模型</p>

                <div class="form-group">
                    <label class="form-label">模型类型</label>
                    <select class="form-select" id="model_list_type">
                        <option value="">全部</option>
                        <option value="llm">LLM</option>
                        <option value="embedding">Embedding</option>
                        <option value="reranker">Reranker</option>
                        <option value="multimodal">Multimodal</option>
                        <option value="image">Image</option>
                        <option value="video">Video</option>
                        <option value="audio">Audio</option>
                    </select>
                </div>

                <button class="btn btn-primary" onclick="listModels()">查询</button>
                <button class="btn btn-secondary" onclick="clearForm('model-list')">清除</button>
                <div class="loading" id="model_list_loading">请求中...</div>
                <div class="response-section" id="model_list_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="model_list_status"></div>
                    <div class="response-body" id="model_list_body"></div>
                </div>
            </div>

            <!-- 模型管理 - 获取模型详情 -->
            <div id="model-get" class="api-section">
                <h2 class="api-title">
                    <span class="api-method method-get">GET</span>
                    获取模型详情
                </h2>
                <p class="api-description">根据ID获取模型详细信息</p>

                <div class="form-group">
                    <label class="form-label">模型ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="model_get_id" placeholder="输入模型ID">
                </div>

                <button class="btn btn-primary" onclick="getModel()">查询</button>
                <button class="btn btn-secondary" onclick="clearForm('model-get')">清除</button>
                <div class="loading" id="model_get_loading">请求中...</div>
                <div class="response-section" id="model_get_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="model_get_status"></div>
                    <div class="response-body" id="model_get_body"></div>
                </div>
            </div>

            <!-- 模型管理 - 模型对话调用 -->
            <div id="model-chat" class="api-section">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    模型对话调用
                </h2>
                <p class="api-description">直接调用指定模型进行对话</p>

                <div class="form-group">
                    <label class="form-label">模型ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="model_chat_id" placeholder="输入模型ID">
                </div>

                <div class="form-group">
                    <label class="form-label">消息 <span class="required">*</span></label>
                    <textarea class="form-textarea" id="model_chat_messages" placeholder='[{"role": "user", "content": "你好"}]'>[]</textarea>
                    <div class="helper-text">JSON格式的消息数组</div>
                </div>

                <div class="inline-group">
                    <div class="form-group">
                        <label class="form-label">Temperature</label>
                        <input type="number" class="form-input" id="model_chat_temperature" value="0.7" min="0" max="2" step="0.1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Max Tokens</label>
                        <input type="number" class="form-input" id="model_chat_max_tokens" value="2000" min="1">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="callModelChat()">调用</button>
                <button class="btn btn-secondary" onclick="clearForm('model-chat')">清除</button>
                <div class="loading" id="model_chat_loading">请求中...</div>
                <div class="response-section" id="model_chat_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="model_chat_status"></div>
                    <div class="response-body" id="model_chat_body"></div>
                </div>
            </div>

            <!-- 模型管理 - 向量化接口 -->
            <div id="model-embeddings" class="api-section">
                <h2 class="api-title">
                    <span class="api-method method-post">POST</span>
                    向量化接口
                </h2>
                <p class="api-description">使用指定的嵌入模型生成文本向量</p>

                <div class="form-group">
                    <label class="form-label">模型ID <span class="required">*</span></label>
                    <input type="text" class="form-input" id="model_embeddings_id" placeholder="输入嵌入模型ID">
                </div>

                <div class="form-group">
                    <label class="form-label">文本内容 <span class="required">*</span></label>
                    <textarea class="form-textarea" id="model_embeddings_input" placeholder="输入要向量化的文本"></textarea>
                    <div class="helper-text">支持单个文本或文本数组（JSON格式）</div>
                </div>

                <button class="btn btn-primary" onclick="callModelEmbeddings()">生成向量</button>
                <button class="btn btn-secondary" onclick="clearForm('model-embeddings')">清除</button>
                <div class="loading" id="model_embeddings_loading">请求中...</div>
                <div class="response-section" id="model_embeddings_response">
                    <div class="response-title">响应结果</div>
                    <div class="response-status" id="model_embeddings_status"></div>
                    <div class="response-body" id="model_embeddings_body"></div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // 环境切换函数
        function switchEnvironment() {
            const envSelector = document.getElementById('envSelector');
            const ipInput = document.getElementById('serverIp');
            const portInput = document.getElementById('serverPort');
            const baseUrlInput = document.getElementById('baseUrl');

            const env = envSelector.value;

            if (env === 'local') {
                ipInput.value = 'localhost';
                portInput.value = '8000';
                ipInput.readOnly = true;
                portInput.readOnly = true;
                updateBaseUrl();
            } else if (env === 'remote') {
                // 远程环境，可以根据你的实际情况设置默认值
                ipInput.value = '';
                portInput.value = '8000';
                ipInput.readOnly = false;
                portInput.readOnly = false;
                ipInput.placeholder = '例如: 192.168.1.100';
            } else if (env === 'custom') {
                ipInput.readOnly = false;
                portInput.readOnly = false;
                ipInput.placeholder = '输入自定义IP或域名';
            }
        }

        // 更新BaseURL
        function updateBaseUrl() {
            const ip = document.getElementById('serverIp').value.trim();
            const port = document.getElementById('serverPort').value.trim();
            const baseUrlInput = document.getElementById('baseUrl');

            if (ip && port) {
                baseUrlInput.value = `http://${ip}:${port}`;
            } else if (ip) {
                baseUrlInput.value = `http://${ip}`;
            }
        }

        // 页面加载后初始化
        window.addEventListener('DOMContentLoaded', function() {
            const ipInput = document.getElementById('serverIp');
            const portInput = document.getElementById('serverPort');

            // 监听IP和端口变化
            ipInput.addEventListener('input', updateBaseUrl);
            portInput.addEventListener('input', updateBaseUrl);

            // 初始化
            updateBaseUrl();
        });

        // Helper functions
        function getBaseUrl() {
            return document.getElementById('baseUrl').value || 'http://localhost:8000';
        }

        function showLoading(section) {
            document.getElementById(section + '_loading').style.display = 'block';
        }

        function hideLoading(section) {
            document.getElementById(section + '_loading').style.display = 'none';
        }

        function showResponse(section, success, data) {
            hideLoading(section);
            
            const statusEl = document.getElementById(section + '_status');
            const bodyEl = document.getElementById(section + '_body');
            
            statusEl.textContent = success ? '成功' : '失败';
            statusEl.className = 'response-status ' + (success ? 'success' : 'error');
            bodyEl.textContent = JSON.stringify(data, null, 2);
        }

        function clearForm(sectionId) {
            const section = document.getElementById(sectionId);
            const inputs = section.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
            
            // Clear response sections
            const responseSections = section.querySelectorAll('.response-section');
            responseSections.forEach(section => {
                const statusEl = section.querySelector('.response-status');
                const bodyEl = section.querySelector('.response-body');
                if (statusEl) statusEl.textContent = '';
                if (bodyEl) bodyEl.textContent = '';
            });
        }

        // Menu navigation
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all menu items
                document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                
                // Add active class to clicked item
                this.classList.add('active');
                
                // Hide all api sections
                document.querySelectorAll('.api-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show selected section
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
            });
        });

        // API Functions
        async function createKB() {
            const name = document.getElementById('kb_create_name').value.trim();
            const desc = document.getElementById('kb_create_desc').value.trim();
            const category = document.getElementById('kb_create_category').value.trim();

            if (!name || !desc) {
                alert('请填写必填字段');
                return;
            }

            showLoading('kb_create');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/kb', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({name, description: desc, category: category || undefined})
                });

                const data = await response.json();
                showResponse('kb_create', response.ok, data);
            } catch (error) {
                showResponse('kb_create', false, {error: error.message});
            }
        }

        async function getKBList() {
            const name = document.getElementById('kb_list_name').value.trim();
            const status = document.getElementById('kb_filter_status').value;
            const category = document.getElementById('kb_list_category').value.trim();
            const page = document.getElementById('kb_list_page') ? document.getElementById('kb_list_page').value || 1 : 1;
            const size = document.getElementById('kb_list_size') ? document.getElementById('kb_list_size').value || 10 : 10;

            let url = getBaseUrl() + '/api/v1/kb?';
            const params = new URLSearchParams();
            
            if (name) params.append('name', name);
            if (status) params.append('status', status);
            if (category) params.append('category', category);
            params.append('page', page);
            params.append('size', size);

            url += params.toString();

            showLoading('kb_list');

            try {
                const response = await fetch(url, {method: 'GET'});
                const data = await response.json();
                showResponse('kb_list', response.ok, data);
            } catch (error) {
                showResponse('kb_list', false, {error: error.message});
            }
        }



        async function getKB() {
            const id = document.getElementById('kb_get_id').value.trim();

            if (!id) {
                alert('请输入知识库ID');
                return;
            }

            showLoading('kb_get');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/kb/' + id, {method: 'GET'});
                const data = await response.json();
                showResponse('kb_get', response.ok, data);
            } catch (error) {
                showResponse('kb_get', false, {error: error.message});
            }
        }

        async function updateKB() {
            const id = document.getElementById('kb_update_id').value.trim();
            const name = document.getElementById('kb_update_name').value.trim();
            const desc = document.getElementById('kb_update_desc').value.trim();
            const category = document.getElementById('kb_update_category').value.trim();
            const status = document.getElementById('kb_update_status').value;

            if (!id) {
                alert('请输入知识库ID');
                return;
            }

            const body = {};
            if (name) body.name = name;
            if (desc) body.description = desc;
            if (category) body.category = category;
            if (status) body.status = parseInt(status);

            if (Object.keys(body).length === 0) {
                alert('请至少填写一个要更新的字段');
                return;
            }

            showLoading('kb_update');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/kb/' + id, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                showResponse('kb_update', response.ok, data);
            } catch (error) {
                showResponse('kb_update', false, {error: error.message});
            }
        }

        async function updateKBStatus() {
            const id = document.getElementById('kb_update_status_id').value.trim();
            const status = document.getElementById('kb_update_status_value').value;

            if (!id || !status) {
                alert('请填写所有必填字段');
                return;
            }

            showLoading('kb_update_status');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/kb/' + id + '/status', {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({status: parseInt(status)})
                });

                const data = await response.json();
                showResponse('kb_update_status', response.ok, data);
            } catch (error) {
                showResponse('kb_update_status', false, {error: error.message});
            }
        }

        async function deleteKB() {
            const id = document.getElementById('kb_delete_id').value.trim();

            if (!id) {
                alert('请输入知识库ID');
                return;
            }

            if (!confirm('确定要删除该知识库吗？此操作不可恢复！')) {
                return;
            }

            showLoading('kb_delete');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/kb/' + id, {
                    method: 'DELETE'
                });

                const data = await response.json();
                showResponse('kb_delete', response.ok, data);
            } catch (error) {
                showResponse('kb_delete', false, {error: error.message});
            }
        }

        async function getDocList() {
            const kbId = document.getElementById('doc_list_kb_id').value.trim();
            const page = document.getElementById('doc_list_page').value;
            const size = document.getElementById('doc_list_size').value;

            if (!kbId) {
                alert('请输入知识库ID');
                return;
            }

            showLoading('doc_list');

            try {
                const response = await fetch(`${getBaseUrl()}/api/v1/documents?knowledge_id=${kbId}&page=${page}&size=${size}`, {
                    method: 'GET'
                });

                const data = await response.json();
                showResponse('doc_list', response.ok, data);
            } catch (error) {
                showResponse('doc_list', false, {error: error.message});
            }
        }



        async function deleteDoc() {
            const docId = document.getElementById('doc_delete_id').value.trim();

            if (!docId) {
                alert('请输入文档ID');
                return;
            }

            if (!confirm('确定要删除该文档吗？此操作不可恢复！')) {
                return;
            }

            showLoading('doc_delete');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/documents?document_id=' + docId, {
                    method: 'DELETE'
                });

                const data = await response.json();
                showResponse('doc_delete', response.ok, data);
            } catch (error) {
                showResponse('doc_delete', false, {error: error.message});
            }
        }

        async function getChunkList() {
            const docId = document.getElementById('chunk_list_doc_id').value.trim();
            const page = document.getElementById('chunk_list_page').value;
            const size = document.getElementById('chunk_list_size').value;

            if (!docId) {
                alert('请输入文档ID');
                return;
            }

            showLoading('chunk_list');

            try {
                const response = await fetch(`${getBaseUrl()}/api/v1/chunks?knowledge_doc_id=${docId}&page=${page}&size=${size}`, {
                    method: 'GET'
                });

                const data = await response.json();
                showResponse('chunk_list', response.ok, data);
            } catch (error) {
                showResponse('chunk_list', false, {error: error.message});
            }
        }

        async function deleteChunk() {
            const chunkId = document.getElementById('chunk_delete_id').value.trim();

            if (!chunkId) {
                alert('请输入Chunk ID');
                return;
            }

            if (!confirm('确定要删除该Chunk吗？此操作不可恢复！')) {
                return;
            }

            showLoading('chunk_delete');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/chunks?id=' + chunkId, {
                    method: 'DELETE'
                });

                const data = await response.json();
                showResponse('chunk_delete', response.ok, data);
            } catch (error) {
                showResponse('chunk_delete', false, {error: error.message});
            }
        }

        async function updateChunkStatus() {
            const chunkIds = document.getElementById('chunk_content_ids').value.trim();
            const status = document.getElementById('chunk_update_status').value;

            if (!chunkIds) {
                alert('请输入Chunk ID列表');
                return;
            }

            const ids = chunkIds.split(',').map(id => id.trim()).filter(id => id);

            if (ids.length === 0) {
                alert('请输入有效的Chunk ID列表');
                return;
            }

            showLoading('chunk_content');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/chunks', {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        ids: ids,
                        status: parseInt(status)
                    })
                });

                const data = await response.json();
                showResponse('chunk_content', response.ok, data);
            } catch (error) {
                showResponse('chunk_content', false, {error: error.message});
            }
        }

        async function uploadFile() {
            const kbId = document.getElementById('upload_kb_id').value.trim();
            const fileInput = document.getElementById('upload_file');
            const urlInput = document.getElementById('upload_url').value.trim();

            if (!kbId) {
                alert('请输入知识库ID');
                return;
            }

            if (!fileInput.files[0] && !urlInput) {
                alert('请选择文件或输入URL');
                return;
            }

            showLoading('upload');

            try {
                const formData = new FormData();
                formData.append('knowledge_id', kbId);
                
                if (fileInput.files[0]) {
                    formData.append('file', fileInput.files[0]);
                }
                
                if (urlInput) {
                    formData.append('url', urlInput);
                }

                const response = await fetch(getBaseUrl() + '/api/v1/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                showResponse('upload', response.ok, data);
            } catch (error) {
                showResponse('upload', false, {error: error.message});
            }
        }

        async function indexDocuments() {
            const docIds = document.getElementById('index_doc_ids').value.trim();
            const embeddingModelId = document.getElementById('index_embedding_model_id').value.trim();
            const chunkSize = document.getElementById('index_chunk_size').value;
            const overlapSize = document.getElementById('index_overlap_size').value;
            const separators = document.getElementById('index_separators').value.trim();

            if (!docIds) {
                alert('请输入文档ID列表');
                return;
            }

            if (!embeddingModelId) {
                alert('请输入Embedding模型ID');
                return;
            }

            const ids = docIds.split(',').map(id => id.trim()).filter(id => id);

            showLoading('index');

            const body = {
                document_ids: ids,
                embedding_model_id: embeddingModelId,
                chunk_size: parseInt(chunkSize),
                overlap_size: parseInt(overlapSize)
            };

            // 添加可选的分隔符参数
            if (separators) {
                body.separators = separators.split(',').map(s => s.trim()).filter(s => s);
            }

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/index', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                showResponse('index', response.ok, data);
            } catch (error) {
                showResponse('index', false, {error: error.message});
            }
        }

        async function retrieve() {
            const kbId = document.getElementById('retriever_kb_id').value.trim();
            const question = document.getElementById('retriever_question').value.trim();
            const embeddingModelId = document.getElementById('retriever_embedding_model_id').value.trim();
            const rerankModelId = document.getElementById('retriever_rerank_model_id').value.trim();
            const topK = document.getElementById('retriever_top_k').value;
            const score = document.getElementById('retriever_score').value;
            const enableRewrite = document.getElementById('retriever_enable_rewrite').value === 'true';
            const rewriteAttempts = document.getElementById('retriever_rewrite_attempts').value;
            const retrieveMode = document.getElementById('retriever_retrieve_mode').value;

            if (!kbId || !question) {
                alert('请填写知识库ID和检索问题');
                return;
            }

            if (!embeddingModelId) {
                alert('请输入Embedding模型ID');
                return;
            }

            showLoading('retriever');

            const body = {
                knowledge_id: kbId,
                question: question,
                embedding_model_id: embeddingModelId,
                top_k: parseInt(topK),
                score: parseFloat(score),
                enable_rewrite: enableRewrite,
                rewrite_attempts: parseInt(rewriteAttempts),
                retrieve_mode: retrieveMode
            };

            // Rerank模型ID是可选的
            if (rerankModelId) {
                body.rerank_model_id = rerankModelId;
            }

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/retriever', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                showResponse('retriever', response.ok, data);
            } catch (error) {
                showResponse('retriever', false, {error: error.message});
            }
        }

        async function chat() {
            const convId = document.getElementById('chat_conv_id').value.trim();
            const modelId = document.getElementById('chat_model_id').value.trim();
            const kbId = document.getElementById('chat_kb_id').value.trim();
            const enableRetriever = document.getElementById('chat_enable_retriever').checked;
            const embeddingModelId = document.getElementById('chat_embedding_model_id').value.trim();
            const rerankModelId = document.getElementById('chat_rerank_model_id').value.trim();
            const question = document.getElementById('chat_question').value.trim();
            const topK = document.getElementById('chat_top_k').value;
            const score = document.getElementById('chat_score').value;
            const retrieveMode = document.getElementById('chat_retrieve_mode').value;
            const useMcp = document.getElementById('chat_use_mcp').checked;
            const mcpServiceToolsStr = document.getElementById('chat_mcp_service_tools').value.trim();
            const fileInput = document.getElementById('chat_file');
            const useStream = document.getElementById('chat_stream').checked;

            if (!convId || !question) {
                alert('请填写会话ID和问题');
                return;
            }

            if (!modelId) {
                alert('请输入LLM模型ID');
                return;
            }

            const body = {
                conv_id: convId,
                model_id: modelId,
                question: question,
                stream: useStream
            };

            // 添加可选参数
            if (kbId) body.knowledge_id = kbId;

            // 添加启用检索参数
            body.enable_retriever = enableRetriever;

            if (enableRetriever) {
                if (!embeddingModelId) {
                    alert('启用检索时必须提供Embedding模型ID');
                    return;
                }
                body.embedding_model_id = embeddingModelId;
                body.top_k = parseInt(topK);
                body.score = parseFloat(score);

                // Rerank模型ID是可选的
                if (rerankModelId) {
                    body.rerank_model_id = rerankModelId;
                }
                if (retrieveMode) {
                    body.retrieve_mode = retrieveMode;
                }
            }
            if (useMcp) {
                body.use_mcp = true;

                // 解析按服务指定的MCP工具
                if (mcpServiceToolsStr) {
                    try {
                        body.mcp_service_tools = JSON.parse(mcpServiceToolsStr);
                    } catch (e) {
                        alert('按服务指定MCP工具格式错误，请输入有效的 JSON');
                        return;
                    }
                }
            }

            showLoading('chat');

            try {
                let response;
                // 检查是否真的有有效文件
                let hasValidFiles = false;
                if (fileInput.files && fileInput.files.length > 0) {
                    // 检查是否有至少一个有效的文件（文件名非空且大小大于0）
                    for (let i = 0; i < fileInput.files.length; i++) {
                        if (fileInput.files[i].name && fileInput.files[i].size > 0) {
                            hasValidFiles = true;
                            break;
                        }
                    }
                }

                // 如果有有效文件上传，使用 FormData
                if (hasValidFiles) {
                    const formData = new FormData();

                    // 只添加有效的文件
                    for (let i = 0; i < fileInput.files.length; i++) {
                        if (fileInput.files[i].name && fileInput.files[i].size > 0) {
                            formData.append('files', fileInput.files[i]);
                        }
                    }

                    // 添加所有其他参数作为独立的 FormData 字段
                    formData.append('conv_id', body.conv_id);
                    formData.append('model_id', body.model_id);
                    formData.append('question', body.question);
                    formData.append('stream', body.stream);

                    if (body.knowledge_id) formData.append('knowledge_id', body.knowledge_id);
                    formData.append('enable_retriever', body.enable_retriever);

                    if (body.enable_retriever) {
                        formData.append('embedding_model_id', body.embedding_model_id);
                        formData.append('top_k', body.top_k);
                        formData.append('score', body.score);
                        if (body.rerank_model_id) {
                            formData.append('rerank_model_id', body.rerank_model_id);
                        }
                        if (body.retrieve_mode) {
                            formData.append('retrieve_mode', body.retrieve_mode);
                        }
                    }

                    if (body.use_mcp) {
                        formData.append('use_mcp', 'true');
                        if (body.mcp_service_tools) {
                            formData.append('mcp_service_tools', JSON.stringify(body.mcp_service_tools));
                        }
                    }

                    response = await fetch(getBaseUrl() + '/api/v1/chat', {
                        method: 'POST',
                        body: formData
                    });
                } else {
                    // 没有文件时，使用 JSON
                    response = await fetch(getBaseUrl() + '/api/v1/chat', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(body)
                    });
                }

                // 处理流式响应
                if (useStream && response.ok) {
                    hideLoading('chat');
                    const statusEl = document.getElementById('chat_status');
                    const bodyEl = document.getElementById('chat_body');

                    statusEl.textContent = '流式接收中...';
                    statusEl.className = 'response-status success';
                    bodyEl.textContent = '';

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let streamedContent = '';

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;

                        const chunk = decoder.decode(value, { stream: true });
                        const lines = chunk.split('\n');

                        for (const line of lines) {
                            if (line.startsWith('data: ')) {
                                const data = line.substring(6).trim();
                                if (data === '[DONE]') {
                                    statusEl.textContent = '完成';
                                    continue;
                                }

                                try {
                                    const json = JSON.parse(data);
                                    if (json.content) {
                                        streamedContent += json.content;
                                        bodyEl.textContent = streamedContent;
                                    }
                                } catch (e) {
                                    // 忽略解析错误
                                }
                            }
                        }
                    }
                } else {
                    // 非流式响应
                    const data = await response.json();
                    showResponse('chat', response.ok, data);
                }
            } catch (error) {
                showResponse('chat', false, {error: error.message});
            }
        }

        async function registerMCP() {
            const name = document.getElementById('mcp_reg_name').value.trim();
            const desc = document.getElementById('mcp_reg_desc').value.trim();
            const endpoint = document.getElementById('mcp_reg_endpoint').value.trim();
            const apiKey = document.getElementById('mcp_reg_apikey').value.trim();
            const headersStr = document.getElementById('mcp_reg_headers').value.trim();

            if (!name || !endpoint) {
                alert('请填写服务名称和端点URL');
                return;
            }

            const body = {
                name: name,
                endpoint: endpoint
            };

            if (desc) body.description = desc;
            if (apiKey) body.api_key = apiKey;
            
            if (headersStr) {
                try {
                    body.headers = headersStr;
                } catch (e) {
                    alert('请求头格式错误，请输入有效的 JSON');
                    return;
                }
            }

            showLoading('mcp_reg');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/mcp/registry', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                showResponse('mcp_reg', response.ok, data);
            } catch (error) {
                showResponse('mcp_reg', false, {error: error.message});
            }
        }

        async function getMCPRegistryList() {
            const status = document.getElementById('mcp_filter_status').value;
            const page = document.getElementById('mcp_list_page').value;
            const size = document.getElementById('mcp_list_size').value;

            let url = getBaseUrl() + '/api/v1/mcp/registry?';
            const params = new URLSearchParams();
            
            if (status) params.append('status', status);
            params.append('page', page);
            params.append('page_size', size);

            url += params.toString();

            showLoading('mcp_list');

            try {
                const response = await fetch(url, {method: 'GET'});
                const data = await response.json();
                showResponse('mcp_list', response.ok, data);
            } catch (error) {
                showResponse('mcp_list', false, {error: error.message});
            }
        }

        async function getMCPRegistry() {
            const id = document.getElementById('mcp_get_id').value.trim();

            if (!id) {
                alert('请输入服务ID');
                return;
            }

            showLoading('mcp_get');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/mcp/registry/' + id, {method: 'GET'});
                const data = await response.json();
                showResponse('mcp_get', response.ok, data);
            } catch (error) {
                showResponse('mcp_get', false, {error: error.message});
            }
        }

        async function updateMCPRegistry() {
            const id = document.getElementById('mcp_update_id').value.trim();
            const name = document.getElementById('mcp_update_name').value.trim();
            const desc = document.getElementById('mcp_update_desc').value.trim();
            const endpoint = document.getElementById('mcp_update_endpoint').value.trim();
            const apiKey = document.getElementById('mcp_update_apikey').value.trim();
            const headersStr = document.getElementById('mcp_update_headers').value.trim();
            const status = document.getElementById('mcp_update_status').value;

            if (!id) {
                alert('请输入服务ID');
                return;
            }

            const body = {};
            if (name) body.name = name;
            if (desc) body.description = desc;
            if (endpoint) body.endpoint = endpoint;
            if (apiKey) body.api_key = apiKey;
            if (headersStr) body.headers = headersStr;
            if (status) body.status = parseInt(status);

            if (Object.keys(body).length === 0) {
                alert('请至少填写一个要更新的字段');
                return;
            }

            showLoading('mcp_update');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/mcp/registry/' + id, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                showResponse('mcp_update', response.ok, data);
            } catch (error) {
                showResponse('mcp_update', false, {error: error.message});
            }
        }

        async function deleteMCPRegistry() {
            const id = document.getElementById('mcp_delete_id').value.trim();

            if (!id) {
                alert('请输入服务ID');
                return;
            }

            if (!confirm('确定要删除该MCP服务吗？')) {
                return;
            }

            showLoading('mcp_delete');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/mcp/registry/' + id, {
                    method: 'DELETE'
                });

                const data = await response.json();
                showResponse('mcp_delete', response.ok, data);
            } catch (error) {
                showResponse('mcp_delete', false, {error: error.message});
            }
        }

        async function testMCPRegistry() {
            const id = document.getElementById('mcp_test_id').value.trim();

            if (!id) {
                alert('请输入服务ID');
                return;
            }

            showLoading('mcp_test');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/mcp/registry/' + id + '/test', {
                    method: 'POST'
                });

                const data = await response.json();
                showResponse('mcp_test', response.ok, data);
            } catch (error) {
                showResponse('mcp_test', false, {error: error.message});
            }
        }

        async function listMCPTools() {
            const id = document.getElementById('mcp_tools_id').value.trim();

            if (!id) {
                alert('请输入服务ID');
                return;
            }

            showLoading('mcp_tools');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/mcp/registry/' + id + '/tools', {
                    method: 'GET'
                });

                const data = await response.json();
                showResponse('mcp_tools', response.ok, data);
            } catch (error) {
                showResponse('mcp_tools', false, {error: error.message});
            }
        }

        async function callMCPTool() {
            const registryId = document.getElementById('mcp_call_registry_id').value.trim();
            const toolName = document.getElementById('mcp_call_tool_name').value.trim();
            const argsStr = document.getElementById('mcp_call_args').value.trim();
            const convId = document.getElementById('mcp_call_conv_id').value.trim();

            if (!registryId || !toolName) {
                alert('请填写服务ID和服务名称');
                return;
            }

            const body = {
                registry_id: registryId,
                tool_name: toolName
            };

            if (argsStr) {
                try {
                    body.arguments = JSON.parse(argsStr);
                } catch (e) {
                    alert('参数格式错误，请输入有效的 JSON');
                    return;
                }
            }

            if (convId) {
                body.conversation_id = convId;
            }

            showLoading('mcp_call');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/mcp/call', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                showResponse('mcp_call', response.ok, data);
            } catch (error) {
                showResponse('mcp_call', false, {error: error.message});
            }
        }

        async function getMCPLogs() {
            const convId = document.getElementById('mcp_logs_conv_id').value.trim();
            const registryId = document.getElementById('mcp_logs_registry_id').value.trim();
            const toolName = document.getElementById('mcp_logs_tool_name').value.trim();
            const page = document.getElementById('mcp_logs_page').value;
            const size = document.getElementById('mcp_logs_size').value;

            let url = getBaseUrl() + '/api/v1/mcp/logs?';
            const params = new URLSearchParams();
            
            if (convId) params.append('conversation_id', convId);
            if (registryId) params.append('registry_id', registryId);
            if (toolName) params.append('tool_name', toolName);
            params.append('page', page);
            params.append('page_size', size);

            url += params.toString();

            showLoading('mcp_logs');

            try {
                const response = await fetch(url, {method: 'GET'});
                const data = await response.json();
                showResponse('mcp_logs', response.ok, data);
            } catch (error) {
                showResponse('mcp_logs', false, {error: error.message});
            }
        }

        async function getMCPStats() {
            const id = document.getElementById('mcp_stats_id').value.trim();

            if (!id) {
                alert('请输入服务ID');
                return;
            }

            showLoading('mcp_stats');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/mcp/registry/' + id + '/stats', {
                    method: 'GET'
                });

                const data = await response.json();
                showResponse('mcp_stats', response.ok, data);
            } catch (error) {
                showResponse('mcp_stats', false, {error: error.message});
            }
        }

        async function registerModel() {
            const modelName = document.getElementById('model_register_name').value.trim();
            const modelType = document.getElementById('model_register_type').value;
            const provider = document.getElementById('model_register_provider').value.trim();
            const baseUrl = document.getElementById('model_register_base_url').value.trim();
            const apiKey = document.getElementById('model_register_api_key').value.trim();
            const contextWindow = document.getElementById('model_register_context_window').value;
            const maxTokens = document.getElementById('model_register_max_tokens').value;
            const dimension = document.getElementById('model_register_dimension').value;
            const configStr = document.getElementById('model_register_config').value.trim();
            const enabled = document.getElementById('model_register_enabled').checked;

            if (!modelName || !modelType) {
                alert('请填写所有必填字段（模型名称和模型类型）');
                return;
            }

            const body = {
                model_name: modelName,
                model_type: modelType,
                enabled: enabled
            };

            if (provider) body.provider = provider;
            if (baseUrl) body.base_url = baseUrl;
            if (apiKey) body.api_key = apiKey;
            if (contextWindow) body.context_window = parseInt(contextWindow);
            if (maxTokens) body.max_tokens = parseInt(maxTokens);
            if (dimension) body.dimension = parseInt(dimension);

            // 验证并解析 config JSON
            if (configStr) {
                try {
                    const config = JSON.parse(configStr);
                    body.config = config;
                } catch (e) {
                    alert('模型其他参数格式错误，请输入有效的 JSON 格式');
                    return;
                }
            }

            showLoading('model_register');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/model/register', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });
                const data = await response.json();
                showResponse('model_register', response.ok, data);
            } catch (error) {
                showResponse('model_register', false, {error: error.message});
            }
        }

        async function updateModel() {
            const modelId = document.getElementById('model_update_id').value.trim();
            if (!modelId) {
                alert('请输入模型ID');
                return;
            }
            const body = {model_id: modelId};
            const modelName = document.getElementById('model_update_name').value.trim();
            const baseUrl = document.getElementById('model_update_base_url').value.trim();
            if (modelName) body.model_name = modelName;
            if (baseUrl) body.base_url = baseUrl;
            showLoading('model_update');
            try {
                const response = await fetch(getBaseUrl() + '/api/v1/model/' + modelId, {method: 'PUT', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body)});
                const data = await response.json();
                showResponse('model_update', response.ok, data);
            } catch (error) {
                showResponse('model_update', false, {error: error.message});
            }
        }

        async function deleteModel() {
            const modelId = document.getElementById('model_delete_id').value.trim();
            if (!modelId) {
                alert('请输入模型ID');
                return;
            }
            if (!confirm('确定要删除该模型吗？此操作不可恢复！')) {
                return;
            }
            showLoading('model_delete');
            try {
                const response = await fetch(getBaseUrl() + '/api/v1/model/' + modelId, {method: 'DELETE'});
                const data = await response.json();
                showResponse('model_delete', response.ok, data);
            } catch (error) {
                showResponse('model_delete', false, {error: error.message});
            }
        }

        async function reloadModels() {
            showLoading('model_reload');
            try {
                const response = await fetch(getBaseUrl() + '/api/v1/model/reload', {
                    method: 'POST'
                });
                const data = await response.json();
                showResponse('model_reload', response.ok, data);
            } catch (error) {
                showResponse('model_reload', false, {error: error.message});
            }
        }

        async function listModels() {
            const modelType = document.getElementById('model_list_type').value;

            let url = getBaseUrl() + '/api/v1/model/list';
            if (modelType) {
                url += '?model_type=' + modelType;
            }

            showLoading('model_list');
            try {
                const response = await fetch(url, {method: 'GET'});
                const data = await response.json();
                showResponse('model_list', response.ok, data);
            } catch (error) {
                showResponse('model_list', false, {error: error.message});
            }
        }

        async function getModel() {
            const modelId = document.getElementById('model_get_id').value.trim();
            if (!modelId) {
                alert('请输入模型ID');
                return;
            }

            showLoading('model_get');
            try {
                const response = await fetch(getBaseUrl() + '/api/v1/model/' + modelId, {method: 'GET'});
                const data = await response.json();
                showResponse('model_get', response.ok, data);
            } catch (error) {
                showResponse('model_get', false, {error: error.message});
            }
        }

        async function callModelChat() {
            const modelId = document.getElementById('model_chat_id').value.trim();
            const messagesStr = document.getElementById('model_chat_messages').value.trim();
            const temperature = document.getElementById('model_chat_temperature').value;
            const maxTokens = document.getElementById('model_chat_max_tokens').value;

            if (!modelId || !messagesStr) {
                alert('请填写模型ID和消息');
                return;
            }

            let messages;
            try {
                messages = JSON.parse(messagesStr);
            } catch (e) {
                alert('消息格式错误，请输入有效的 JSON 数组');
                return;
            }

            const body = {
                model_id: modelId,
                messages: messages,
                temperature: parseFloat(temperature),
                max_tokens: parseInt(maxTokens)
            };

            showLoading('model_chat');
            try {
                const response = await fetch(getBaseUrl() + '/api/v1/model/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });
                const data = await response.json();
                showResponse('model_chat', response.ok, data);
            } catch (error) {
                showResponse('model_chat', false, {error: error.message});
            }
        }

        async function callModelEmbeddings() {
            const modelId = document.getElementById('model_embeddings_id').value.trim();
            const inputStr = document.getElementById('model_embeddings_input').value.trim();

            if (!modelId || !inputStr) {
                alert('请填写模型ID和文本内容');
                return;
            }

            // 尝试解析为 JSON 数组，如果失败则作为字符串处理
            let input;
            try {
                input = JSON.parse(inputStr);
            } catch (e) {
                input = inputStr;
            }

            const body = {
                model_id: modelId,
                input: input
            };

            showLoading('model_embeddings');
            try {
                const response = await fetch(getBaseUrl() + '/api/v1/model/embeddings', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });
                const data = await response.json();
                showResponse('model_embeddings', response.ok, data);
            } catch (error) {
                showResponse('model_embeddings', false, {error: error.message});
            }
        }
    </script>
</body>
</html>