<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG API 调试工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .config-section {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .config-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .config-row {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .config-row label {
            font-weight: 600;
            min-width: 80px;
        }

        .config-row input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .main-content {
            display: flex;
            height: calc(100vh - 250px);
        }

        .sidebar {
            width: 280px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            overflow-y: auto;
        }

        .menu-section {
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .menu-section-title {
            padding: 10px 20px;
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
            color: #6c757d;
            letter-spacing: 0.5px;
        }

        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            color: #495057;
            font-size: 14px;
        }

        .menu-item:hover {
            background: #e9ecef;
        }

        .menu-item.active {
            background: white;
            border-left-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .api-section {
            display: none;
        }

        .api-section.active {
            display: block;
        }

        .api-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }

        .api-description {
            color: #6c757d;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .api-method {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 12px;
            margin-right: 10px;
        }

        .method-get { background: #28a745; color: white; }
        .method-post { background: #007bff; color: white; }
        .method-put { background: #ffc107; color: #333; }
        .method-delete { background: #dc3545; color: white; }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-textarea {
            min-height: 100px;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .form-file {
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .response-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .response-section.show {
            display: block;
        }

        .response-title {
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
        }

        .response-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 4px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .response-body {
            background: #fff;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 500px;
            overflow-y: auto;
        }

        .loading {
            display: none;
            margin-top: 10px;
            color: #667eea;
            font-style: italic;
        }

        .loading.show {
            display: block;
        }

        .helper-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        .inline-group {
            display: flex;
            gap: 15px;
        }

        .inline-group .form-group {
            flex: 1;
        }

        .stream-container {
            background: #fff;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            min-height: 200px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .required {
            color: #dc3545;
            margin-left: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>RAG API 调试工具</h1>
            <p>快速调试和测试所有知识库相关API接口</p>
        </div>

        <div class="config-section">
            <h3>基础配置</h3>
            <div class="config-row">
                <label>API地址:</label>
                <input type="text" id="baseUrl" value="http://localhost:8000" placeholder="http://localhost:8000">
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <!-- 知识库管理 -->
                <div class="menu-section">
                    <div class="menu-section-title">知识库管理</div>
                    <div class="menu-item active" data-section="kb-create">创建知识库</div>
                    <div class="menu-item" data-section="kb-list">知识库列表</div>
                    <div class="menu-item" data-section="kb-get">获取知识库详情</div>
                    <div class="menu-item" data-section="kb-update">更新知识库</div>
                    <div class="menu-item" data-section="kb-delete">删除知识库</div>
                </div>

                <!-- 文档管理 -->
                <div class="menu-section">
                    <div class="menu-section-title">文档管理</div>
                    <div class="menu-item" data-section="doc-list">文档列表</div>
                    <div class="menu-item" data-section="doc-delete">删除文档</div>
                </div>

                <!-- Chunks管理 -->
                <div class="menu-section">
                    <div class="menu-section-title">Chunks管理</div>
                    <div class="menu-item" data-section="chunk-list">Chunks列表</div>
                    <div class="menu-item" data-section="chunk-delete">删除Chunk</div>
                    <div class="menu-item" data-section="chunk-update-status">更新Chunk状态</div>
                    <div class="menu-item" data-section="chunk-update-content">更新Chunk内容</div>
                </div>

                <!-- 索引 -->
                <div class="menu-section">
                    <div class="menu-section-title">索引管理</div>
                    <div class="menu-item" data-section="indexer-upload">文档索引(上传)</div>
                    <div class="menu-item" data-section="indexer-url">文档索引(URL)</div>
                </div>

                <!-- 检索 -->
                <div class="menu-section">
                    <div class="menu-section-title">检索</div>
                    <div class="menu-item" data-section="retriever">标准检索</div>
                    <div class="menu-item" data-section="retriever-dify">Dify检索</div>
                </div>

                <!-- 对话 -->
                <div class="menu-section">
                    <div class="menu-section-title">对话</div>
                    <div class="menu-item" data-section="chat">普通对话</div>
                    <div class="menu-item" data-section="chat-stream">流式对话</div>
                </div>
            </div>

            <div class="content-area">
                <!-- 创建知识库 -->
                <div class="api-section active" id="kb-create">
                    <h2 class="api-title">
                        <span class="api-method method-post">POST</span>
                        创建知识库
                    </h2>
                    <p class="api-description">创建一个新的知识库，系统会自动在Milvus中创建对应的集合</p>

                    <div class="form-group">
                        <label class="form-label">知识库名称 <span class="required">*</span></label>
                        <input type="text" class="form-input" id="kb_create_name" placeholder="例如: 技术文档库">
                        <div class="helper-text">长度3-50字符</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">描述 <span class="required">*</span></label>
                        <textarea class="form-textarea" id="kb_create_desc" placeholder="例如: 存储所有技术相关文档"></textarea>
                        <div class="helper-text">长度3-200字符</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">分类</label>
                        <input type="text" class="form-input" id="kb_create_category" placeholder="例如: 技术">
                        <div class="helper-text">可选，长度3-50字符</div>
                    </div>

                    <button class="btn btn-primary" onclick="createKB()">创建知识库</button>
                    <button class="btn btn-secondary" onclick="clearForm('kb-create')">清空</button>

                    <div class="loading" id="kb_create_loading">请求中...</div>

                    <div class="response-section" id="kb_create_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="kb_create_status"></div>
                        <div class="response-body" id="kb_create_body"></div>
                    </div>
                </div>

                <!-- 知识库列表 -->
                <div class="api-section" id="kb-list">
                    <h2 class="api-title">
                        <span class="api-method method-get">GET</span>
                        知识库列表
                    </h2>
                    <p class="api-description">获取知识库列表，支持按名称、状态、分类过滤</p>

                    <div class="form-group">
                        <label class="form-label">知识库名称</label>
                        <input type="text" class="form-input" id="kb_list_name" placeholder="模糊查询，可选">
                    </div>

                    <div class="inline-group">
                        <div class="form-group">
                            <label class="form-label">状态</label>
                            <select class="form-select" id="kb_list_status">
                                <option value="">全部</option>
                                <option value="1">启用</option>
                                <option value="2">禁用</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">分类</label>
                            <input type="text" class="form-input" id="kb_list_category" placeholder="可选">
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="getKBList()">查询</button>
                    <button class="btn btn-secondary" onclick="clearForm('kb-list')">清空</button>

                    <div class="loading" id="kb_list_loading">请求中...</div>

                    <div class="response-section" id="kb_list_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="kb_list_status_text"></div>
                        <div class="response-body" id="kb_list_body"></div>
                    </div>
                </div>

                <!-- 获取知识库详情 -->
                <div class="api-section" id="kb-get">
                    <h2 class="api-title">
                        <span class="api-method method-get">GET</span>
                        获取知识库详情
                    </h2>
                    <p class="api-description">根据ID获取单个知识库的详细信息</p>

                    <div class="form-group">
                        <label class="form-label">知识库ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="kb_get_id" placeholder="输入知识库ID">
                    </div>

                    <button class="btn btn-primary" onclick="getKB()">查询</button>
                    <button class="btn btn-secondary" onclick="clearForm('kb-get')">清空</button>

                    <div class="loading" id="kb_get_loading">请求中...</div>

                    <div class="response-section" id="kb_get_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="kb_get_status"></div>
                        <div class="response-body" id="kb_get_body"></div>
                    </div>
                </div>

                <!-- 更新知识库 -->
                <div class="api-section" id="kb-update">
                    <h2 class="api-title">
                        <span class="api-method method-put">PUT</span>
                        更新知识库
                    </h2>
                    <p class="api-description">更新知识库信息，所有字段都是可选的</p>

                    <div class="form-group">
                        <label class="form-label">知识库ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="kb_update_id" placeholder="输入知识库ID">
                    </div>

                    <div class="form-group">
                        <label class="form-label">知识库名称</label>
                        <input type="text" class="form-input" id="kb_update_name" placeholder="新的名称">
                    </div>

                    <div class="form-group">
                        <label class="form-label">描述</label>
                        <textarea class="form-textarea" id="kb_update_desc" placeholder="新的描述"></textarea>
                    </div>

                    <div class="inline-group">
                        <div class="form-group">
                            <label class="form-label">分类</label>
                            <input type="text" class="form-input" id="kb_update_category" placeholder="新的分类">
                        </div>

                        <div class="form-group">
                            <label class="form-label">状态</label>
                            <select class="form-select" id="kb_update_status">
                                <option value="">不修改</option>
                                <option value="1">启用</option>
                                <option value="2">禁用</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="updateKB()">更新</button>
                    <button class="btn btn-secondary" onclick="clearForm('kb-update')">清空</button>

                    <div class="loading" id="kb_update_loading">请求中...</div>

                    <div class="response-section" id="kb_update_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="kb_update_status_text"></div>
                        <div class="response-body" id="kb_update_body"></div>
                    </div>
                </div>

                <!-- 删除知识库 -->
                <div class="api-section" id="kb-delete">
                    <h2 class="api-title">
                        <span class="api-method method-delete">DELETE</span>
                        删除知识库
                    </h2>
                    <p class="api-description">删除知识库及其在Milvus中的集合，此操作不可恢复</p>

                    <div class="form-group">
                        <label class="form-label">知识库ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="kb_delete_id" placeholder="输入知识库ID">
                    </div>

                    <button class="btn btn-primary" onclick="deleteKB()">删除</button>
                    <button class="btn btn-secondary" onclick="clearForm('kb-delete')">清空</button>

                    <div class="loading" id="kb_delete_loading">请求中...</div>

                    <div class="response-section" id="kb_delete_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="kb_delete_status"></div>
                        <div class="response-body" id="kb_delete_body"></div>
                    </div>
                </div>

                <!-- 文档列表 -->
                <div class="api-section" id="doc-list">
                    <h2 class="api-title">
                        <span class="api-method method-get">GET</span>
                        文档列表
                    </h2>
                    <p class="api-description">获取指定知识库下的文档列表，支持分页</p>

                    <div class="form-group">
                        <label class="form-label">知识库ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="doc_list_kb_id" placeholder="输入知识库ID">
                    </div>

                    <div class="inline-group">
                        <div class="form-group">
                            <label class="form-label">页码 <span class="required">*</span></label>
                            <input type="number" class="form-input" id="doc_list_page" value="1" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">每页数量 <span class="required">*</span></label>
                            <input type="number" class="form-input" id="doc_list_size" value="10" min="1" max="100">
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="getDocList()">查询</button>
                    <button class="btn btn-secondary" onclick="clearForm('doc-list')">清空</button>

                    <div class="loading" id="doc_list_loading">请求中...</div>

                    <div class="response-section" id="doc_list_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="doc_list_status"></div>
                        <div class="response-body" id="doc_list_body"></div>
                    </div>
                </div>

                <!-- 删除文档 -->
                <div class="api-section" id="doc-delete">
                    <h2 class="api-title">
                        <span class="api-method method-delete">DELETE</span>
                        删除文档
                    </h2>
                    <p class="api-description">删除文档及其所有chunks，同时删除Milvus中的向量数据</p>

                    <div class="form-group">
                        <label class="form-label">文档ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="doc_delete_id" placeholder="输入文档ID">
                    </div>

                    <button class="btn btn-primary" onclick="deleteDoc()">删除</button>
                    <button class="btn btn-secondary" onclick="clearForm('doc-delete')">清空</button>

                    <div class="loading" id="doc_delete_loading">请求中...</div>

                    <div class="response-section" id="doc_delete_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="doc_delete_status"></div>
                        <div class="response-body" id="doc_delete_body"></div>
                    </div>
                </div>

                <!-- Chunks列表 -->
                <div class="api-section" id="chunk-list">
                    <h2 class="api-title">
                        <span class="api-method method-get">GET</span>
                        Chunks列表
                    </h2>
                    <p class="api-description">获取指定文档的chunks列表，支持分页</p>

                    <div class="form-group">
                        <label class="form-label">文档ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="chunk_list_doc_id" placeholder="输入文档ID">
                    </div>

                    <div class="inline-group">
                        <div class="form-group">
                            <label class="form-label">页码 <span class="required">*</span></label>
                            <input type="number" class="form-input" id="chunk_list_page" value="1" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">每页数量 <span class="required">*</span></label>
                            <input type="number" class="form-input" id="chunk_list_size" value="10" min="1" max="100">
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="getChunkList()">查询</button>
                    <button class="btn btn-secondary" onclick="clearForm('chunk-list')">清空</button>

                    <div class="loading" id="chunk_list_loading">请求中...</div>

                    <div class="response-section" id="chunk_list_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="chunk_list_status"></div>
                        <div class="response-body" id="chunk_list_body"></div>
                    </div>
                </div>

                <!-- 删除Chunk -->
                <div class="api-section" id="chunk-delete">
                    <h2 class="api-title">
                        <span class="api-method method-delete">DELETE</span>
                        删除Chunk
                    </h2>
                    <p class="api-description">删除指定chunk，同时删除Milvus中的向量数据</p>

                    <div class="form-group">
                        <label class="form-label">Chunk ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="chunk_delete_id" placeholder="输入Chunk ID">
                    </div>

                    <button class="btn btn-primary" onclick="deleteChunk()">删除</button>
                    <button class="btn btn-secondary" onclick="clearForm('chunk-delete')">清空</button>

                    <div class="loading" id="chunk_delete_loading">请求中...</div>

                    <div class="response-section" id="chunk_delete_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="chunk_delete_status"></div>
                        <div class="response-body" id="chunk_delete_body"></div>
                    </div>
                </div>

                <!-- 更新Chunk状态 -->
                <div class="api-section" id="chunk-update-status">
                    <h2 class="api-title">
                        <span class="api-method method-put">PUT</span>
                        更新Chunk状态
                    </h2>
                    <p class="api-description">批量更新chunks的启用/禁用状态</p>

                    <div class="form-group">
                        <label class="form-label">Chunk IDs <span class="required">*</span></label>
                        <input type="text" class="form-input" id="chunk_status_ids" placeholder="多个ID用逗号分隔，例如: 1,2,3">
                        <div class="helper-text">多个ID用逗号分隔</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">状态 <span class="required">*</span></label>
                        <select class="form-select" id="chunk_status_value">
                            <option value="1">启用</option>
                            <option value="0">禁用</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" onclick="updateChunkStatus()">更新</button>
                    <button class="btn btn-secondary" onclick="clearForm('chunk-update-status')">清空</button>

                    <div class="loading" id="chunk_status_loading">请求中...</div>

                    <div class="response-section" id="chunk_status_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="chunk_status_status"></div>
                        <div class="response-body" id="chunk_status_body"></div>
                    </div>
                </div>

                <!-- 更新Chunk内容 -->
                <div class="api-section" id="chunk-update-content">
                    <h2 class="api-title">
                        <span class="api-method method-put">PUT</span>
                        更新Chunk内容
                    </h2>
                    <p class="api-description">更新chunk内容，会异步重新索引到Milvus</p>

                    <div class="form-group">
                        <label class="form-label">Chunk ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="chunk_content_id" placeholder="输入Chunk ID">
                    </div>

                    <div class="form-group">
                        <label class="form-label">新内容 <span class="required">*</span></label>
                        <textarea class="form-textarea" id="chunk_content_value" placeholder="输入新的chunk内容"></textarea>
                    </div>

                    <button class="btn btn-primary" onclick="updateChunkContent()">更新</button>
                    <button class="btn btn-secondary" onclick="clearForm('chunk-update-content')">清空</button>

                    <div class="loading" id="chunk_content_loading">请求中...</div>

                    <div class="response-section" id="chunk_content_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="chunk_content_status"></div>
                        <div class="response-body" id="chunk_content_body"></div>
                    </div>
                </div>

                <!-- 文档索引(上传) -->
                <div class="api-section" id="indexer-upload">
                    <h2 class="api-title">
                        <span class="api-method method-post">POST</span>
                        文档索引(上传文件)
                    </h2>
                    <p class="api-description">上传本地文件并进行向量化索引</p>

                    <div class="form-group">
                        <label class="form-label">知识库ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="indexer_upload_kb_id" placeholder="输入知识库ID">
                    </div>

                    <div class="form-group">
                        <label class="form-label">文件 <span class="required">*</span></label>
                        <input type="file" class="form-file" id="indexer_upload_file">
                    </div>

                    <div class="form-group">
                        <label class="form-label">是否QA切分</label>
                        <select class="form-select" id="indexer_upload_is_qa">
                            <option value="0">否</option>
                            <option value="1">是</option>
                        </select>
                        <div class="helper-text">QA切分适用于问答对格式的文档</div>
                    </div>

                    <div class="inline-group">
                        <div class="form-group">
                            <label class="form-label">Chunk Size</label>
                            <input type="number" class="form-input" id="indexer_upload_chunk_size" value="1000" min="1">
                            <div class="helper-text">文档分块大小，默认1000</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Overlap Size</label>
                            <input type="number" class="form-input" id="indexer_upload_overlap_size" value="100" min="0">
                            <div class="helper-text">分块重叠大小，默认100</div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="uploadIndexer()">上传并索引</button>
                    <button class="btn btn-secondary" onclick="clearForm('indexer-upload')">清空</button>

                    <div class="loading" id="indexer_upload_loading">请求中...</div>

                    <div class="response-section" id="indexer_upload_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="indexer_upload_status"></div>
                        <div class="response-body" id="indexer_upload_body"></div>
                    </div>
                </div>

                <!-- 文档索引(URL) -->
                <div class="api-section" id="indexer-url">
                    <h2 class="api-title">
                        <span class="api-method method-post">POST</span>
                        文档索引(URL)
                    </h2>
                    <p class="api-description">通过URL下载文件并进行向量化索引</p>

                    <div class="form-group">
                        <label class="form-label">知识库ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="indexer_url_kb_id" placeholder="输入知识库ID">
                    </div>

                    <div class="form-group">
                        <label class="form-label">文件URL <span class="required">*</span></label>
                        <input type="text" class="form-input" id="indexer_url_url" placeholder="例如: https://example.com/doc.pdf">
                    </div>

                    <div class="form-group">
                        <label class="form-label">是否QA切分</label>
                        <select class="form-select" id="indexer_url_is_qa">
                            <option value="0">否</option>
                            <option value="1">是</option>
                        </select>
                    </div>

                    <div class="inline-group">
                        <div class="form-group">
                            <label class="form-label">Chunk Size</label>
                            <input type="number" class="form-input" id="indexer_url_chunk_size" value="1000" min="1">
                            <div class="helper-text">文档分块大小，默认1000</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Overlap Size</label>
                            <input type="number" class="form-input" id="indexer_url_overlap_size" value="100" min="0">
                            <div class="helper-text">分块重叠大小，默认100</div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="urlIndexer()">索引URL文档</button>
                    <button class="btn btn-secondary" onclick="clearForm('indexer-url')">清空</button>

                    <div class="loading" id="indexer_url_loading">请求中...</div>

                    <div class="response-section" id="indexer_url_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="indexer_url_status"></div>
                        <div class="response-body" id="indexer_url_body"></div>
                    </div>
                </div>

                <!-- 标准检索 -->
                <div class="api-section" id="retriever">
                    <h2 class="api-title">
                        <span class="api-method method-post">POST</span>
                        标准检索
                    </h2>
                    <p class="api-description">根据问题从知识库检索相关文档</p>

                    <div class="form-group">
                        <label class="form-label">知识库ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="retriever_kb_id" placeholder="输入知识库ID">
                    </div>

                    <div class="form-group">
                        <label class="form-label">查询问题 <span class="required">*</span></label>
                        <textarea class="form-textarea" id="retriever_question" placeholder="输入您的问题"></textarea>
                    </div>

                    <div class="inline-group">
                        <div class="form-group">
                            <label class="form-label">Top K</label>
                            <input type="number" class="form-input" id="retriever_top_k" value="5" min="1">
                            <div class="helper-text">返回文档数量，默认5</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">相似度阈值</label>
                            <input type="number" class="form-input" id="retriever_score" value="0.2" min="0" max="1" step="0.1">
                            <div class="helper-text">0-1之间，默认0.2</div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="retrieve()">检索</button>
                    <button class="btn btn-secondary" onclick="clearForm('retriever')">清空</button>

                    <div class="loading" id="retriever_loading">请求中...</div>

                    <div class="response-section" id="retriever_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="retriever_status"></div>
                        <div class="response-body" id="retriever_body"></div>
                    </div>
                </div>

                <!-- Dify检索 -->
                <div class="api-section" id="retriever-dify">
                    <h2 class="api-title">
                        <span class="api-method method-post">POST</span>
                        Dify检索
                    </h2>
                    <p class="api-description">兼容Dify格式的检索接口</p>

                    <div class="form-group">
                        <label class="form-label">知识库ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="dify_kb_id" placeholder="输入知识库ID">
                    </div>

                    <div class="form-group">
                        <label class="form-label">查询问题 <span class="required">*</span></label>
                        <textarea class="form-textarea" id="dify_query" placeholder="输入您的问题"></textarea>
                    </div>

                    <div class="inline-group">
                        <div class="form-group">
                            <label class="form-label">Top K</label>
                            <input type="number" class="form-input" id="dify_top_k" value="5" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">相似度阈值</label>
                            <input type="number" class="form-input" id="dify_score" value="0.2" min="0" max="1" step="0.1">
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="difyRetrieve()">检索</button>
                    <button class="btn btn-secondary" onclick="clearForm('retriever-dify')">清空</button>

                    <div class="loading" id="dify_loading">请求中...</div>

                    <div class="response-section" id="dify_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="dify_status"></div>
                        <div class="response-body" id="dify_body"></div>
                    </div>
                </div>

                <!-- 普通对话 -->
                <div class="api-section" id="chat">
                    <h2 class="api-title">
                        <span class="api-method method-post">POST</span>
                        普通对话
                    </h2>
                    <p class="api-description">基于知识库的问答对话（RAG）</p>

                    <div class="form-group">
                        <label class="form-label">会话ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="chat_conv_id" placeholder="输入会话ID，例如: session_123">
                    </div>

                    <div class="form-group">
                        <label class="form-label">知识库ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="chat_kb_id" placeholder="输入知识库ID">
                    </div>

                    <div class="form-group">
                        <label class="form-label">问题 <span class="required">*</span></label>
                        <textarea class="form-textarea" id="chat_question" placeholder="输入您的问题"></textarea>
                    </div>

                    <div class="inline-group">
                        <div class="form-group">
                            <label class="form-label">Top K</label>
                            <input type="number" class="form-input" id="chat_top_k" value="5" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">相似度阈值</label>
                            <input type="number" class="form-input" id="chat_score" value="0.2" min="0" max="1" step="0.1">
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="chat()">发送</button>
                    <button class="btn btn-secondary" onclick="clearForm('chat')">清空</button>

                    <div class="loading" id="chat_loading">请求中...</div>

                    <div class="response-section" id="chat_response">
                        <div class="response-title">响应结果</div>
                        <div class="response-status" id="chat_status"></div>
                        <div class="response-body" id="chat_body"></div>
                    </div>
                </div>

                <!-- 流式对话 -->
                <div class="api-section" id="chat-stream">
                    <h2 class="api-title">
                        <span class="api-method method-post">POST</span>
                        流式对话
                    </h2>
                    <p class="api-description">基于知识库的流式问答对话（RAG），使用SSE实时返回</p>

                    <div class="form-group">
                        <label class="form-label">会话ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="chat_stream_conv_id" placeholder="输入会话ID，例如: session_123">
                    </div>

                    <div class="form-group">
                        <label class="form-label">知识库ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="chat_stream_kb_id" placeholder="输入知识库ID">
                    </div>

                    <div class="form-group">
                        <label class="form-label">问题 <span class="required">*</span></label>
                        <textarea class="form-textarea" id="chat_stream_question" placeholder="输入您的问题"></textarea>
                    </div>

                    <div class="inline-group">
                        <div class="form-group">
                            <label class="form-label">Top K</label>
                            <input type="number" class="form-input" id="chat_stream_top_k" value="5" min="1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">相似度阈值</label>
                            <input type="number" class="form-input" id="chat_stream_score" value="0.2" min="0" max="1" step="0.1">
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="chatStream()">发送</button>
                    <button class="btn btn-secondary" onclick="clearForm('chat-stream')">清空</button>

                    <div class="loading" id="chat_stream_loading">请求中...</div>

                    <div class="response-section" id="chat_stream_response">
                        <div class="response-title">流式响应</div>
                        <div class="response-status" id="chat_stream_status"></div>
                        <div class="stream-container" id="chat_stream_body"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 获取基础URL
        function getBaseUrl() {
            return document.getElementById('baseUrl').value.trim();
        }

        // 显示加载状态
        function showLoading(prefix) {
            document.getElementById(prefix + '_loading').classList.add('show');
            document.getElementById(prefix + '_response').classList.remove('show');
        }

        // 隐藏加载状态
        function hideLoading(prefix) {
            document.getElementById(prefix + '_loading').classList.remove('show');
        }

        // 显示响应
        function showResponse(prefix, success, data) {
            hideLoading(prefix);
            const responseSection = document.getElementById(prefix + '_response');
            const statusEl = document.getElementById(prefix + '_status');
            const bodyEl = document.getElementById(prefix + '_body');

            responseSection.classList.add('show');
            statusEl.className = 'response-status ' + (success ? 'status-success' : 'status-error');
            statusEl.textContent = success ? '请求成功' : '请求失败';
            bodyEl.textContent = JSON.stringify(data, null, 2);
        }

        // 清空表单
        function clearForm(sectionId) {
            const section = document.getElementById(sectionId);
            const inputs = section.querySelectorAll('input[type="text"], input[type="number"], textarea, select');
            inputs.forEach(input => {
                if (input.type === 'number') {
                    input.value = input.defaultValue || '';
                } else if (input.tagName === 'SELECT') {
                    input.selectedIndex = 0;
                } else {
                    input.value = '';
                }
            });

            const fileInputs = section.querySelectorAll('input[type="file"]');
            fileInputs.forEach(input => input.value = '');
        }

        // 菜单切换
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function() {
                // 移除所有active状态
                document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                document.querySelectorAll('.api-section').forEach(s => s.classList.remove('active'));

                // 添加active状态
                this.classList.add('active');
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
            });
        });

        // ==================== 知识库管理 ====================

        // 创建知识库
        async function createKB() {
            const name = document.getElementById('kb_create_name').value.trim();
            const description = document.getElementById('kb_create_desc').value.trim();
            const category = document.getElementById('kb_create_category').value.trim();

            if (!name || !description) {
                alert('请填写必填字段');
                return;
            }

            showLoading('kb_create');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/kb', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({name, description, category})
                });

                const data = await response.json();
                showResponse('kb_create', response.ok, data);
            } catch (error) {
                showResponse('kb_create', false, {error: error.message});
            }
        }

        // 获取知识库列表
        async function getKBList() {
            const name = document.getElementById('kb_list_name').value.trim();
            const status = document.getElementById('kb_list_status').value;
            const category = document.getElementById('kb_list_category').value.trim();

            const params = new URLSearchParams();
            if (name) params.append('name', name);
            if (status) params.append('status', status);
            if (category) params.append('category', category);

            showLoading('kb_list');

            try {
                const url = getBaseUrl() + '/api/v1/kb' + (params.toString() ? '?' + params.toString() : '');
                const response = await fetch(url);
                const data = await response.json();
                showResponse('kb_list', response.ok, data);
            } catch (error) {
                showResponse('kb_list', false, {error: error.message});
            }
        }

        // 获取知识库详情
        async function getKB() {
            const id = document.getElementById('kb_get_id').value.trim();

            if (!id) {
                alert('请输入知识库ID');
                return;
            }

            showLoading('kb_get');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/kb/' + id);
                const data = await response.json();
                showResponse('kb_get', response.ok, data);
            } catch (error) {
                showResponse('kb_get', false, {error: error.message});
            }
        }

        // 更新知识库
        async function updateKB() {
            const id = document.getElementById('kb_update_id').value.trim();
            const name = document.getElementById('kb_update_name').value.trim();
            const description = document.getElementById('kb_update_desc').value.trim();
            const category = document.getElementById('kb_update_category').value.trim();
            const status = document.getElementById('kb_update_status').value;

            if (!id) {
                alert('请输入知识库ID');
                return;
            }

            const body = {};
            if (name) body.name = name;
            if (description) body.description = description;
            if (category) body.category = category;
            if (status) body.status = parseInt(status);

            showLoading('kb_update');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/kb/' + id, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                showResponse('kb_update', response.ok, data);
            } catch (error) {
                showResponse('kb_update', false, {error: error.message});
            }
        }

        // 删除知识库
        async function deleteKB() {
            const id = document.getElementById('kb_delete_id').value.trim();

            if (!id) {
                alert('请输入知识库ID');
                return;
            }

            if (!confirm('确定要删除该知识库吗？此操作不可恢复！')) {
                return;
            }

            showLoading('kb_delete');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/kb/' + id, {
                    method: 'DELETE'
                });

                const data = await response.json();
                showResponse('kb_delete', response.ok, data);
            } catch (error) {
                showResponse('kb_delete', false, {error: error.message});
            }
        }

        // ==================== 文档管理 ====================

        // 获取文档列表
        async function getDocList() {
            const kbId = document.getElementById('doc_list_kb_id').value.trim();
            const page = document.getElementById('doc_list_page').value;
            const size = document.getElementById('doc_list_size').value;

            if (!kbId) {
                alert('请输入知识库ID');
                return;
            }

            showLoading('doc_list');

            try {
                const url = `${getBaseUrl()}/api/v1/documents?knowledge_id=${kbId}&page=${page}&size=${size}`;
                const response = await fetch(url);
                const data = await response.json();
                showResponse('doc_list', response.ok, data);
            } catch (error) {
                showResponse('doc_list', false, {error: error.message});
            }
        }

        // 删除文档
        async function deleteDoc() {
            const docId = document.getElementById('doc_delete_id').value.trim();

            if (!docId) {
                alert('请输入文档ID');
                return;
            }

            if (!confirm('确定要删除该文档吗？此操作不可恢复！')) {
                return;
            }

            showLoading('doc_delete');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/documents?document_id=' + docId, {
                    method: 'DELETE'
                });

                const data = await response.json();
                showResponse('doc_delete', response.ok, data);
            } catch (error) {
                showResponse('doc_delete', false, {error: error.message});
            }
        }

        // ==================== Chunks管理 ====================

        // 获取Chunks列表
        async function getChunkList() {
            const docId = document.getElementById('chunk_list_doc_id').value.trim();
            const page = document.getElementById('chunk_list_page').value;
            const size = document.getElementById('chunk_list_size').value;

            if (!docId) {
                alert('请输入文档ID');
                return;
            }

            showLoading('chunk_list');

            try {
                const url = `${getBaseUrl()}/api/v1/chunks?knowledge_doc_id=${docId}&page=${page}&size=${size}`;
                const response = await fetch(url);
                const data = await response.json();
                showResponse('chunk_list', response.ok, data);
            } catch (error) {
                showResponse('chunk_list', false, {error: error.message});
            }
        }

        // 删除Chunk
        async function deleteChunk() {
            const chunkId = document.getElementById('chunk_delete_id').value.trim();

            if (!chunkId) {
                alert('请输入Chunk ID');
                return;
            }

            if (!confirm('确定要删除该Chunk吗？此操作不可恢复！')) {
                return;
            }

            showLoading('chunk_delete');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/chunks?id=' + chunkId, {
                    method: 'DELETE'
                });

                const data = await response.json();
                showResponse('chunk_delete', response.ok, data);
            } catch (error) {
                showResponse('chunk_delete', false, {error: error.message});
            }
        }

        // 更新Chunk状态
        async function updateChunkStatus() {
            const ids = document.getElementById('chunk_status_ids').value.trim();
            const status = document.getElementById('chunk_status_value').value;

            if (!ids) {
                alert('请输入Chunk IDs');
                return;
            }

            const idsArray = ids.split(',').map(id => id.trim()).filter(id => id);

            showLoading('chunk_status');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/chunks?ids=' + idsArray.join(',') + '&status=' + status, {
                    method: 'PUT'
                });

                const data = await response.json();
                showResponse('chunk_status', response.ok, data);
            } catch (error) {
                showResponse('chunk_status', false, {error: error.message});
            }
        }

        // 更新Chunk内容
        async function updateChunkContent() {
            const id = document.getElementById('chunk_content_id').value.trim();
            const content = document.getElementById('chunk_content_value').value.trim();

            if (!id || !content) {
                alert('请填写必填字段');
                return;
            }

            showLoading('chunk_content');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/chunks_content?id=' + id + '&content=' + encodeURIComponent(content), {
                    method: 'PUT'
                });

                const data = await response.json();
                showResponse('chunk_content', response.ok, data);
            } catch (error) {
                showResponse('chunk_content', false, {error: error.message});
            }
        }

        // ==================== 索引 ====================

        // 上传文件索引
        async function uploadIndexer() {
            const kbId = document.getElementById('indexer_upload_kb_id').value.trim();
            const fileInput = document.getElementById('indexer_upload_file');
            const isQA = document.getElementById('indexer_upload_is_qa').value;
            const chunkSize = document.getElementById('indexer_upload_chunk_size').value;
            const overlapSize = document.getElementById('indexer_upload_overlap_size').value;

            if (!kbId) {
                alert('请输入知识库ID');
                return;
            }

            if (!fileInput.files || !fileInput.files[0]) {
                alert('请选择文件');
                return;
            }

            showLoading('indexer_upload');

            try {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                formData.append('knowledge_id', kbId);
                formData.append('is_qa', isQA);
                formData.append('chunk_size', chunkSize);
                formData.append('overlap_size', overlapSize);

                const response = await fetch(getBaseUrl() + '/api/v1/indexer', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                showResponse('indexer_upload', response.ok, data);
            } catch (error) {
                showResponse('indexer_upload', false, {error: error.message});
            }
        }

        // URL索引
        async function urlIndexer() {
            const kbId = document.getElementById('indexer_url_kb_id').value.trim();
            const url = document.getElementById('indexer_url_url').value.trim();
            const isQA = document.getElementById('indexer_url_is_qa').value;
            const chunkSize = document.getElementById('indexer_url_chunk_size').value;
            const overlapSize = document.getElementById('indexer_url_overlap_size').value;

            if (!kbId || !url) {
                alert('请填写必填字段');
                return;
            }

            showLoading('indexer_url');

            try {
                const formData = new FormData();
                formData.append('url', url);
                formData.append('knowledge_id', kbId);
                formData.append('is_qa', isQA);
                formData.append('chunk_size', chunkSize);
                formData.append('overlap_size', overlapSize);

                const response = await fetch(getBaseUrl() + '/api/v1/indexer', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                showResponse('indexer_url', response.ok, data);
            } catch (error) {
                showResponse('indexer_url', false, {error: error.message});
            }
        }

        // ==================== 检索 ====================

        // 标准检索
        async function retrieve() {
            const kbId = document.getElementById('retriever_kb_id').value.trim();
            const question = document.getElementById('retriever_question').value.trim();
            const topK = parseInt(document.getElementById('retriever_top_k').value);
            const score = parseFloat(document.getElementById('retriever_score').value);

            if (!kbId || !question) {
                alert('请填写必填字段');
                return;
            }

            showLoading('retriever');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/retriever', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        knowledge_id: kbId,
                        question: question,
                        top_k: topK,
                        score: score
                    })
                });

                const data = await response.json();
                showResponse('retriever', response.ok, data);
            } catch (error) {
                showResponse('retriever', false, {error: error.message});
            }
        }

        // Dify检索
        async function difyRetrieve() {
            const kbId = document.getElementById('dify_kb_id').value.trim();
            const query = document.getElementById('dify_query').value.trim();
            const topK = parseInt(document.getElementById('dify_top_k').value);
            const score = parseFloat(document.getElementById('dify_score').value);

            if (!kbId || !query) {
                alert('请填写必填字段');
                return;
            }

            showLoading('dify');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/dify/retrieval', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        knowledge_id: kbId,
                        query: query,
                        retrieval_setting: {
                            top_k: topK,
                            score_threshold: score
                        }
                    })
                });

                const data = await response.json();
                showResponse('dify', response.ok, data);
            } catch (error) {
                showResponse('dify', false, {error: error.message});
            }
        }

        // ==================== 对话 ====================

        // 普通对话
        async function chat() {
            const convId = document.getElementById('chat_conv_id').value.trim();
            const kbId = document.getElementById('chat_kb_id').value.trim();
            const question = document.getElementById('chat_question').value.trim();
            const topK = parseInt(document.getElementById('chat_top_k').value);
            const score = parseFloat(document.getElementById('chat_score').value);

            if (!convId || !kbId || !question) {
                alert('请填写必填字段');
                return;
            }

            showLoading('chat');

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        conv_id: convId,
                        knowledge_id: kbId,
                        question: question,
                        top_k: topK,
                        score: score
                    })
                });

                const data = await response.json();
                showResponse('chat', response.ok, data);
            } catch (error) {
                showResponse('chat', false, {error: error.message});
            }
        }

        // 流式对话
        async function chatStream() {
            const convId = document.getElementById('chat_stream_conv_id').value.trim();
            const kbId = document.getElementById('chat_stream_kb_id').value.trim();
            const question = document.getElementById('chat_stream_question').value.trim();
            const topK = parseInt(document.getElementById('chat_stream_top_k').value);
            const score = parseFloat(document.getElementById('chat_stream_score').value);

            if (!convId || !kbId || !question) {
                alert('请填写必填字段');
                return;
            }

            showLoading('chat_stream');

            const responseSection = document.getElementById('chat_stream_response');
            const statusEl = document.getElementById('chat_stream_status');
            const bodyEl = document.getElementById('chat_stream_body');

            bodyEl.textContent = '';

            try {
                const response = await fetch(getBaseUrl() + '/api/v1/chat/stream', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        conv_id: convId,
                        knowledge_id: kbId,
                        question: question,
                        top_k: topK,
                        score: score
                    })
                });

                hideLoading('chat_stream');
                responseSection.classList.add('show');
                statusEl.className = 'response-status status-success';
                statusEl.textContent = '正在接收流式响应...';

                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const {done, value} = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value, {stream: true});
                    bodyEl.textContent += chunk;
                    bodyEl.scrollTop = bodyEl.scrollHeight;
                }

                statusEl.textContent = '流式响应完成';

            } catch (error) {
                hideLoading('chat_stream');
                responseSection.classList.add('show');
                statusEl.className = 'response-status status-error';
                statusEl.textContent = '请求失败';
                bodyEl.textContent = JSON.stringify({error: error.message}, null, 2);
            }
        }
    </script>
</body>
</html>